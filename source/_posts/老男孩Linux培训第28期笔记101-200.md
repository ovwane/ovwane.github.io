---
---
# 0101
完成期中架构老师带你们去玩

# 0102 
## 表达
2016/3/11 18:01:32
>1. 觉得会了是不够，还要表达出来，交流，尽可能教给不会的人！
>2. 表达出来，是一次将知识装进潜意识的过程。
>3. 只有把知识装进潜意识里，将来才能迅速取出来用。

听课，就是把知识放入意识的过程，潜意识层面的知识不是你的，放到潜意识里，真正的学会了。
只有把知识装入潜意识了，将来才能迅速取出来用。

潜意识：信念 价值观 行动

让老板加薪
信念：让他相信你牛逼，相信对公司的贡献大，对他忠诚。
价值观：方法有了
行动：才可能有结果。

# 0103
重要子目录说明
网卡配置

```
/etc/sysconfig/network-scripts/ifcfg-eth{0-?}
DEVICE=eth1 设备名字
ONBOOT=yes 开机启动
BOOTPROTO=static 静态协议
IPADDR=192.168.33.3 主机地址
NETMASK=255.255.255.0 子网掩码
GATEWAY=192.168.33.1 网关
DNS1=114.114.114.114
DNS2=8.8.8.8
```
```
#查看网关IP
route -n
```

```
#重启所有网卡
/etc/init.f/network restart
#开启eth0网卡
ipup eth0
```
blkid

# 0104
DNS配置
/etc/resolv.conf

网卡的dns重启后会覆盖resolv.conf的dns配置

# 0105
/etc/hosts

hosts 企业里的作用：
1、开发，产品，测试等人员，用于通过正式的域名测试产品。
2、服务器之间的调用可以用域名（内部的DNS），方便迁移。

# 0106
/etc/sysconfig/network

配置主机名和网关

```
HOSTNAME=oldboy

hostname oldboy
```

# 0107
/etc/fstab

实现开机要挂载的文件系统的一个文件

# 0108
/etc/rc.local

用于存放开机自启动程序命令的文件。
chkconfig一般用来管理yum/rpm安装的程序。

自己开发的程序一般习惯把启动命令放入/etc/rc.local。

企业里如何用：chkconfig和/etc/rc.local，可以选择/etc/rc.local做服务器的档案记录。

/etc/inittab

设定系统启动时init进程将把系统设置成什么样的runlevel，运行级别及加载相关的级别对应启动文件配置

# 0109
刚毕业学生拿到offer
11*12 五险一金4000交。

回去总结

目录
1、nginx会话保持的问题
	1.1 实现会话（session）保持的几种方法：
		1.1.1 ip_hash：
		1.1.2 url_hash：
	1.2 当后端服务器后，可以采用下面的方法：
		1.2.1 一致性HASH算法
		1.2.2 基于Memcached储存session
2、数据库主琴技了，开发怎么处理
3、反向代理的硬件配置
4、压力测试怎么做的


 /etc/exports 设定NFS网络文件系统用的配置文件。
 
 /etc/init.d 这个目录是用来存放系统或服务器通过rpm/yum安装的软件默认的开机启动脚本的目录以 SystemV模式启动的脚本。
 
 /etc/init.d/链接到/etc/rc.d/init.d目录
 
 /etc/xinit.d 如果服务是通过xinetd模式运行的，他的脚本要放在/etc/xinit.d目录下，PXE+kickstart的tftp会用到/etc/xinit.d
 
 /etc/profile 系统全局环境变量
~/.bash_profile ~/.bashrc 用户环境变量
 
 /etc/profile.d 加载系统登录程序的一个目录，命令或文件独立存放，以文件的形式存在（*.sh)，要加可执行权限。
 
 /etc/profile.d 登录后执行的脚本所在地
 /etc/motd 登录后显示的提示字符串。
 
# 0110
/etc/issue 登录前提示
/etc/motd 登录后提示
 /etc/redhat-release 版本信息
 /usr/local 通过源码编译的软件存放闻之
 /usr/src 内核源码存放位置
 /var 系统默认日志文件
 /var/log/message 日志文件，按周轮训切割日志。
 /var/log/secure 登录日志。
 ```
 dmesg 查看系统信息
 
 ifup ifdown 启动和停止网卡
 ```
 
[往期学生有关目录结构的总结](http://yangrong.blog.51cto.com/6945369/1288072)

 /proc
 /proc/version 
 /proc/cpuinfo
 /proc/meminfo
 /proc/loadavg
 /proc/mount
 
# 0111
课后作业
总结，上机考试

# 0112
老男孩教育linux运维就业班第一关课后学习效果能力上机大考查

1. 创建目录/data/oldboy，并且在该目录下创建文件oldboy.txt，然后在文件oldboy.txt 里写入内容“inet addr：10.0.0.8  Bcast:10.0.0.255 Mask:255.255.255.0"（不包含引号）

```
mkdir -p /data/oldboy
cd /data/oldboy
touch oldboy.txt
echo "inet addr：10.0.0.8  Bcast:10.0.0.255 Mask:255.255.255.0">oldboy.txt
```

2. 将题1中的oldboy.txt文件内容通过命令过滤只输出如下内容。10.0.0.8  10.0.0.255 255.255.255.0

```

```

3. 将题1中的oldboy目录移动到/tmp目录，并将/etc/passwd文件复制到/tmp/oldboy下。

```
cp -r /data/oldboy /tmp/
cp /etc/passwd /tmp/oldboy/
```

4. 在题三的基础上，使用awk取passwd文件的第10行到20行的第三列重定向到/tmp/oldboy/test.txt文件里

```
awk -F':' 'NR>=10 && NR<=20 {print $3}' /tmp/oldboy/passwd>/tmp/oldboy/test.txt
```

5. 在题3的基础上要求用命令rm删除文件时提示如下禁止使用rm的提示，并使该效果永久生效。

```
echo "alias rm="echo not use rm commond"">>~/.bashrc
```

6. 在题3的基础上，删除/tmp/oldboy下除passwd以外的其他文件

```
find /tmp/oldboy -type f ! -name "passwd" -exec rm -f {} \;
```

7. 在题3的基础上，请打印/etc/passwd文件中的第2-5行（不低于三种方法）

```
head -5 passwd|tail -3
grep 2 -C 5 passwd
sed '2,5p' passwd
```

8. 在题3的基础上，使用命令调换root位置和/bin/bash位置？即将所有的第一列和最后一列位置调换？例：
默认root:x:0:0:/root:/bin/bash 修改后为 /bin/bash：0:0:/root:root

```
```

9. 把/data目录及其子目录下所有以扩展名.txt结尾的文件中包含oldgir的字符串全部替换为oldboy

```
find /data -type f -name "*.txt"|xargs sed -i 's/oldgirl/oldboy/g'
```

10. 查找/oldboy下所有7天以前log结尾的大于1M的文件移动/tmp下

```
find /oldboy -type f -date +7 size +1M -name "*.log" -exec mv {} /tmp \;
```

11. 什么是linux的运行级别，请描述linux的运行级别不同数字的含义？（附加题）

```

0 关机
1 单用户
2 没有nfs的多用户
3 多用户
4 未定义
5 图形化x11
6 重启
```

# 0113
## 第一题
```
mkdir -p /data/oldboy
touch /data/oldboy/oldboy.txt
ifconfig|sed -n '2p'>/data/oldboy/oldboy.txt
```

## 第二题
```
awk -F "[ :]+" '{print $3,$5,$7}' oldboy.txt

-F 分割符 这次有两个分割符空格和分号所以使用[]+
```

## 第三题
```
mv /data/oldboy /tmp
cp /etc/passwd /tmp/oldboy
```

## 第四题
```
cd /tmp/oldboy
awk -F ":" 'NR>9 && NR<21{print $3}' passwd>test.txt
```

## 第五题
```
echo "alias rm="Do not use rm command."">> /etc/profile ~/.bashrc
```

## 第六题
```
ls|grep -v passwd|xargs rm -f
find /tmp/oldboy -type f ! -name "passwd" -exec rm -f {} \;
find /tmp/oldboy -type f ! -name "passwd"|xargs rm -f
```

## 第七题
```
head -5 /etc/passwd|tail -4
sed -n '2,5p' /etc/passwd
awk 'NR>1 && NR<6' /etc/passwd
cat -n passwd|grep "\s2\s" -A 3
```

# 0114
## 第八题
```
awk -F ":" 'NR==1{print $7":"$2":"$3":"$4":"$5":"$6":"$1}' passwd
sed -ir 's#(.*):x(.*):(.*)#\3\2\1#g' passwd
```

## 第九题
```
find /data -type f -name "*.txt"|xargs sed -i 's/oldgirl/oldboy/g'
```

## 第十题
```
dd if=/tmp/ss.txt of =/dev/zero bs=1 count=1.1M

find /oldboy -type f -name "*.log" -size +1M -mtime +7 -exec mv {} /tmp \;
```

# 0115
## 第十一题
```

```

## 第十二题
```
buffer 互联网写入硬盘，先缓存到内存
cache 硬盘读取数据，先缓存到内存
```

## 第十三题
```
~
-
.
..
|
>
>>
<
<<
!
```

# 0116
郭玉祥 未来的大神


```
xargs 
xargs -n 1 分组
```

[企业面试题：查找/oldboy下所有7天以前以log结尾的文件移动/tmp下。](http://oldboy.blog.51cto.com/blog/2561410/1750481)

企业必考面试题：查找/oldboy目录下所有7天以前的以log结尾的文件移动到/tmp下。 
要求：请给出至少三种实现方法，有能力的朋友试试看！

工作做事给老大，给面试官多种方案，让领导有多种选择，才叫有能力，
只有一种方法，让老大没得选择，不叫有能力；
有两种方法，让老大左右为难，也不叫有能力；
有两种以上方法，可以让老大有选择的余地，才叫有能力；
有选择才叫有能力！

>老男孩教育教学理念就是所有学生做事，都要给出两种以上的方法！
去企业面试也是如此！如果同一个问题你给出了多种方法，直接秒杀其他竞争对手，
这也是老男孩教育学生持续高薪，多年来秒杀所有同行linux培训机构的核心思想所在。
---------老男孩老师

>更高级的运维思想，在公司的岗位上，要努力做到让领导别无选择，做到了再自己的岗位上让你的领导别无选择，你拿高薪就是轻而易举的事！如何做到让领导别无选择，见老男孩运维思想新篇（2016最新面授和在线课程运维思想更新80%以上，招招让你秒杀其他运维竞争者）！
技术的提升只是量的积累，思想的提升才是质的飞跃！
---------老男孩老师

```
mv `find /oldboy -type f "*.log" -mtime ＋7` /tmp/
find /oldboy -type f -name ".log" -mtime ＋7 -exec mv {} /tmp \;
find /oldboy -type f -name ".log" -mtime ＋7 |xargs -i mv {} /tmp
```
```
ls -l|awk '{print $7 " " $9 " "strftime("%d")}'|awk '{if($1＋7<$3) print ("mv " $2 " /tmp/")}'|bash

find /oldboy/ -mtime ＋7 -type f -name "*.log"|sed -r 's#(.*)#mv \1 /tmp/#'|bash
```

# 0117
>看一遍就理解了、就明白了那就不正常了。

>大家听一遍就会了、那你凭什么拿1万多的工资。

# 0118
总结的经验：

1、学会总结是学好运维的重要前提。

2、通过案例或例子来总结一个技术点或者命令。

3、画一张逻辑图，形象的卡通记忆这个知识技术点。

4、通过管道过滤数据时，最好先输出结果，然后回退再使用管道看着结果过滤。

```
linux三剑客正则表达式
	^ 以什么开头的，例子：^d 以d开头的。
	$ 以什么结尾的，例子：/$ 以斜杠结尾的。
	
ls list 列出文件和目录
	-F 给不同文件加标示
	-p 只给目录加标示

-maxdepath 查找深度 tree -L 类似
find ./* -maxdepath 1 -type d
find ./* -maxdepath 1 -type d -name "."

awk '(if$2>1) print $0'

awk 
```

查找目录

```
ls -l|grep "^d"
ls -l|awk '{if($2>1) print $0}'
ls -F|grep "^d"
ls -F|grep "/$"
find . -maxdepath 1 -type d ! -name "."
```

/etc/passwd

NR 行数 NF行尾一列

```
awk -F ":" 'NR==1 {print $1,$4,$NF}' /etc/passwd
```


[老男孩浅谈如何看待运维？](http://oldboy.blog.51cto.com/2561410/830451)

老男孩语录-老男孩浅谈如何看待运维？
运维，很容易从字面理解为运营、维护。
大部分朋友认为，在互联网公司中linux系统运维的工作就是安装系统，部署服务
处理紧急故障，为公司开发人员及其它部门提供支持。同时负责内外网的网络稳定。
------------------------------
没错，上面的工作的确是运维的一部分工作，但并不是全部，或者说是中小公司低级的运维劳动。
在老男孩看来，除了上面的角色外，运维人员还是管理、制度、规范、流程的制定和推行、监督角色。
运维的核心是运维思想，非运维技术本身（如部署服务等，这是部分朋友的误区）。
上百台以上的服务器的规模如果没有好的管理流程、规范、制度策略，是无法协调工作的。
上千台、上万台更是如此。
运维流程、运维规范、运维制度、自动化、智能化、批量部署、批量管理、网站架构优化、监控预警、流量及日志分析统计、成本控制（注意字眼是控制，不是节省）
才是真正的运维人员需要做的。
如何推进并完善上面的工作，提升工作效率，提升团队以一当十的战斗力才是最核心的内容。
运维的宗旨：保护数据安全、7*24小时网络稳定、用户体验良好（用户包括内部的员工、外部的网站用户）
所以，我们做什么都不要离开运维的宗旨，否则，你的工作都可能是徒劳的无用功（起码和目标没直接对接）。
有经验的运维人员会先思考在动作，经验不足的运维人员会先做，遇到问题在思考，这是完全不同的层次和境界。
试想盖一座大楼如果先盖好在思考，那还能盖好么？
所以，请别轻易说你精通什么什么服务，会多少多少软件，那只是几块砖头、几袋水泥、几根钢筋而已。
盖好大楼，这些仅仅是基本的元素，运维同样是如此！
 

[2016打算做运维的人员必知必晓的知识](http://oldboy.blog.51cto.com/blog/2561410/1740750)

（1）运维人员要谨记的6个字：
运维人员做事需遵循：简单、易用、高效
（2）运维人员服务的3大宗旨：
1、企业数据安全保障。
2、7*24小时业务持续提供服务。
3、不断提升用户感受、体验。
（3）初中级运维的日常涉及工作:
1、评估产品需求及发展需求，设计网站架构。
2、选择IDC公司、云产品，CDN等产品。
3、采购服务器、安装系统、配置服务、服务器IDC上架。
4、调试网络、优化系统及服务。
5、上线代码、配合研发搭建环境、调试、测试代码。
6、监控硬件、软件及各种业务应用。
7、配置收集日志和，根据日志信息报警及优化系统及服务 
8、解决日常问题，如硬件（服务器、交换机、硬件、网络）、软件（网络服务）、各类业务服务故障。 
9、编写自动化脚本(Shell,Python)，自动化部署服务。
（4）高级运维涉及的工作:
1、监控带宽、流量、并发、业务接口等关键资源及访问信息的变化趋势。
2、根据相应趋势变化不断优化网站架构。
3、设计各类解决方案，解决公司业务发展中的遇到的网站瓶颈。
4、编写各种自动化脚本(Shell,Python)，自动化部署优化服务。
5、开发自动化部署和管理平台（CMDB），实现平台化运维。
5、开发运维管理平台、及运维工具产品，提升服务效率。
6、制定运维流程、规范、制度，并有序推进。
7、研究先进运维理念、模式，确保业务持续稳定、有序。


# 0119
```
ls -l|sed -n '/^d/p'
ls -lF|sed -n '/\/$/p'
```

# 0120

date

```
ls -lrt 
	-t 	按修改时间排序，最新的再最下面
	-r 反转排序
	--color=auto 显示颜色

grep --color=auto 关键字加颜色
```

>女生最喜欢的是抱、解决被爱的需求
>女孩子心思

## 访问日志按天切割 只保留7天的。
生成测试环境

```
mkdir /app/apache/
cd /app/apache
for n in `seq 14`;do date -s "2016/01/$n"; touch access_www_$(date +%F).log;done
```
```
for n in `seq 14`
do
	date -s "2014/08/$n"
	touch access_www_`(date +%F)`.log
done

date -s "
```

```
find /app/logs/ -type f -mtime +7|xargs rm -f
find /app/logs/ -type f -mtime +7 -exec rm -f {} \;
rm -f `find /app/logs/ -type f -mtime +7`
```

按周覆盖日志 apache日志

```
CustomLog "|/usr/loca/sbin/cronolog /app/logs/access_www_%w.log" combined
```

# 0121
调试系统服务 /var/log/messages

tail -f 

```bash
for n in `seq 1000`
do
	echo $n>>a.txt
	sleep 1
done
```

[JAVA企业级应用TOMCAT实战](http://blog.oldboyedu.com/java-tomcat/)

# 0122
打印行号

```
echo stu{1..20}|xargs -n 1>nginx.conf
echo "">>nginx.conf
echo "stu21">>nginx.conf

cat -n
nl 显示行号,不显示空格。空格行不计数。
grep -n .
vi -c set:nu 
awk '{print NR,$0}'
#sed -n "/N:1,20/p"
sed = nginx.conf|sed 'N:s/\n/ /'

more 按页显示，可以翻页，只能往下翻页，
less 按页显示，可以翻页，可以上下翻页，b可以退回一屏
```

# 0123
nfs仅在3级开启

```
chkconfig nfs off
chkconfig nfs on 3
```

 ## 如何优化linux系统
 01）不用root，添加普通用户，通过sudo授权
 02）更改默认ssh服务端口，禁止root用户远程连接
 03）定时自动更新服务器时间。
 04）配置yum源为国内的
 05）关闭selinux和iptables
 06）调整文件limit.conf
 07）定时自动清理/var/spool/clientmquene目录垃圾，防止inode节点被占满，centos6.4默认没有sendmail。可以不配置。
 08）精简开机自启动服务（crond，sshd，network，rsyslog）
 09）linux内核参数优化/etc/sysctl.conf，执行sysctl -p生效
 10）更改字符集
 11）锁定关键系统文件
 chattr +i /etc/passwd /etc/shadow /etc/group /etc/gshadow /wtc/inittab
 12）清空/etc/issue，除去系统及内核版本登录前的屏幕显示
 13）清楚无用的默认系统账号或组
 
 更多优化细节[oldboy](http://oldboy.blog.51cto.com/2561410/988726)

特别提示：本文适合于11期第10此小综合架构考试系统优化。

```
一、Linux优化（安全+性能=32条）.................................................................................. 3
1.服务器硬件采购优化............................................................................................... 3
1.1 硬件供货商选择........................................................................................... 3
1.2主要硬件部件选择......................................................................................... 3
1.3定制化采购硬件............................................................................................ 3
2.磁盘RAID选择、mount 及文件系统优化................................................................ 3
2.1 磁盘类型接口选择优化................................................................................. 3
2.2 hdparm优化.................................................................................................. 4
2.3磁盘挂载(mount)优化.................................................................................... 4
2.4 RAID选择优化............................................................................................... 4
3.操作系统选择优化.................................................................................................. 5
4.最小化软件包安装优化........................................................................................... 5
5.禁止开机自启动无用服务........................................................................................ 5
6.禁止root通过SSH远程登录并更改SSH端口............................................................ 6
7. chattr锁定关键系统文件........................................................................................ 7
8.内核优化（/etc/sysctl.conf）................................................................................... 7
9.1 lvs/haproxy负载均衡代理内核参数配置.......................................................... 7
9.2 nginx/apache生产内核参数优化案例.............................................................. 8
9.3 squid/varnish/nginx proxy生产内核优化案例.................................................... 8
9.4内核参数优化特别说明.................................................................................. 9
10.增加系统文件描述符............................................................................................. 9
11.配置sudo对普通用户权限精细控制....................................................................... 9
12.禁ping(非必须).................................................................................................... 10
13.关闭多余的控制台(非必须).................................................................................. 10
14.清除多余的系统虚拟账号(非必须)........................................................................ 10
15.配置防火墙iptables和SELinux.............................................................................. 11
16. grub加密码(非必须)............................................................................................ 11
17.设置/etc/hosts.deny、/etc/hosts.allow(非必须)...................................................... 12
18.配置YUM安装源................................................................................................. 12
19.禁止键盘重启（/etc/inittab），使用字符模式level 3............................................ 12
20. /tmp临时目录安全............................................................................................. 12
21.用户口令8位以上、定期更换、动态口令等........................................................ 13
22.注销账号的时间，命令的历史记录数................................................................... 13
23.删除登录信息(非必须)......................................................................................... 13
24.安装系统性能监控软件监控调试软件................................................................... 13
25.防病毒软件clamav，入侵检测ids、Tripwire。..................................................... 14
26.配置服务器和互联网时间同步............................................................................. 14
27.配置系统日志审计............................................................................................... 14
28.操作系统磁盘分区划分优化................................................................................. 14
29.负载均衡集群架构不同设备选型优化................................................................... 16
29.1负载均衡器硬件选择及raid级别................................................................ 16
29.2 WEB层硬件选择及raid级别....................................................................... 16
29.3 数据库层硬件选择及raid级别(适合mysql和oracle)................................... 16
29.4 存储层硬件选择及raid级别...................................................................... 16
29.4.1数据备份硬件选择及raid级别.......................................................... 16
29.4.2共享存储NFS硬件选择及raid级别................................................... 16
30 linux服务器尽量少配外网IP地址......................................................................... 16
31.linux系统一键优化脚本....................................................................................... 17
32.linux一键安装（snmp,nagios,cacti,puppet等）客户端脚本.................................... 24
```

[awk](http://oldboy.blog.51cto.com/2561410/950730)
[sed](http://oldboy.blog.51cto.com/2561410/949365)

```
wc 
	-l 显示line数
	-w 显示单词数
	-c 
	-L 显示标准字符数
```	

# 0124
11k

马自强

笔记
记笔记

学会做人，学会感恩！

学会老师的思想

# 0125
自启动

```
vi /etc/rc.local
/etc/init.d/sshd start
```
```
chkconfig 设置服务开机自启动

chkconfig --level 345 on 启动服务的级别
chkconfig --list 显示所有的服务
chkconfig --list sshd
```

# 0126
开机启动流程

BIOS
MBR bootloader 446byte
GRUB
加载kernel
# INIT进程 进程号为1
inittab 选择init level
/etc/rc..d/rc.sysvinit fstab rc.local
/etc/rc.d/rc

mingetty 进程

# 0127
/etc/rc.d/rc.sysvinit

chkconfig -add 添加自定义开机项

# 0128
精简开机系统启动

sshd
crond
network
rsyslog
sysstat

实现思路：

先全部关掉

然后再开启需要的

操作实现：

```
egrep "3306|80" /etc/services

 awk '{print "chkconfig",$1,"off"}'
 ```

生产案例：优化精简开机自启动服务

```
chkconfig --list|grep 3:on|grep -vE "crond|sshd|network|rsyslog|sysstat"|awk '{print "chkconfig" $1 "off"}'|bash
```

# 0130