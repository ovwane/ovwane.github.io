<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>幻舞梦境</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="幻舞梦境">
<meta property="og:url" content="https://ovwane.icu/page/32/index.html">
<meta property="og:site_name" content="幻舞梦境">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="幻舞梦境">
  
    <link rel="alternative" href="/atom.xml" title="幻舞梦境" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
     
      <meta name="baidu-site-verification" content="3rC08I0Cp6">
    
     
      <meta name="google-site-verification" content="rn8f25RzFQoiByt8ezg9E17KZIElbIlwJ4y-EKSlWbA">
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet">
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">幻舞梦境</a></h1>
        </hgroup>

        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                            <li><a href="/archives">博客归档</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github" target="_blank" href="https://github.com/ovwane" title="github">github</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Ansible/" style="font-size: 11.67px;">Ansible</a> <a href="/tags/Bind/" style="font-size: 10px;">Bind</a> <a href="/tags/Cacti/" style="font-size: 10px;">Cacti</a> <a href="/tags/CentOS/" style="font-size: 20px;">CentOS</a> <a href="/tags/Cobbler/" style="font-size: 10px;">Cobbler</a> <a href="/tags/DHCP/" style="font-size: 10px;">DHCP</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Gitlab/" style="font-size: 11.67px;">Gitlab</a> <a href="/tags/HAProxy/" style="font-size: 10px;">HAProxy</a> <a href="/tags/Hexo/" style="font-size: 11.67px;">Hexo</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Jenkins/" style="font-size: 11.67px;">Jenkins</a> <a href="/tags/KVM/" style="font-size: 10px;">KVM</a> <a href="/tags/Kubernetes/" style="font-size: 10px;">Kubernetes</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/MariaDB/" style="font-size: 10px;">MariaDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/NFS/" style="font-size: 10px;">NFS</a> <a href="/tags/Nagios/" style="font-size: 10px;">Nagios</a> <a href="/tags/Nginx/" style="font-size: 16.67px;">Nginx</a> <a href="/tags/Oh-My-Zsh/" style="font-size: 10px;">Oh My Zsh</a> <a href="/tags/OpenLDAP/" style="font-size: 10px;">OpenLDAP</a> <a href="/tags/OpenStack/" style="font-size: 10px;">OpenStack</a> <a href="/tags/PHP/" style="font-size: 11.67px;">PHP</a> <a href="/tags/PXE/" style="font-size: 10px;">PXE</a> <a href="/tags/Python/" style="font-size: 13.33px;">Python</a> <a href="/tags/RHEL7/" style="font-size: 10px;">RHEL7</a> <a href="/tags/Resin/" style="font-size: 10px;">Resin</a> <a href="/tags/Samba/" style="font-size: 10px;">Samba</a> <a href="/tags/Scrapy/" style="font-size: 10px;">Scrapy</a> <a href="/tags/Scrapyd/" style="font-size: 10px;">Scrapyd</a> <a href="/tags/SpiderKeeper/" style="font-size: 10px;">SpiderKeeper</a> <a href="/tags/Squid/" style="font-size: 10px;">Squid</a> <a href="/tags/Subversion/" style="font-size: 10px;">Subversion</a> <a href="/tags/Supervisor/" style="font-size: 10px;">Supervisor</a> <a href="/tags/Tomcat/" style="font-size: 13.33px;">Tomcat</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Zabbix/" style="font-size: 10px;">Zabbix</a> <a href="/tags/Zsh/" style="font-size: 10px;">Zsh</a> <a href="/tags/cacti/" style="font-size: 10px;">cacti</a> <a href="/tags/dovecot/" style="font-size: 10px;">dovecot</a> <a href="/tags/httpd/" style="font-size: 11.67px;">httpd</a> <a href="/tags/iSCSI/" style="font-size: 10px;">iSCSI</a> <a href="/tags/k8s/" style="font-size: 10px;">k8s</a> <a href="/tags/kickstart/" style="font-size: 10px;">kickstart</a> <a href="/tags/macOS/" style="font-size: 16.67px;">macOS</a> <a href="/tags/nagios/" style="font-size: 10px;">nagios</a> <a href="/tags/postfix/" style="font-size: 10px;">postfix</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/sshd/" style="font-size: 10px;">sshd</a> <a href="/tags/uWSGI/" style="font-size: 10px;">uWSGI</a> <a href="/tags/vsftpd/" style="font-size: 10px;">vsftpd</a> <a href="/tags/zabbix/" style="font-size: 10px;">zabbix</a> <a href="/tags/历史/" style="font-size: 18.33px;">历史</a> <a href="/tags/学习笔记/" style="font-size: 10px;">学习笔记</a> <a href="/tags/情感/" style="font-size: 10px;">情感</a> <a href="/tags/生活/" style="font-size: 10px;">生活</a> <a href="/tags/监控/" style="font-size: 13.33px;">监控</a> <a href="/tags/网络/" style="font-size: 10px;">网络</a> <a href="/tags/自己/" style="font-size: 10px;">自己</a> <a href="/tags/运维/" style="font-size: 10px;">运维</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://luuman.github.io/">name</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">纯海迷、爱运动、爱交友、爱旅行、喜欢接触新鲜事物、迎接新的挑战，更爱游离于错综复杂的编码与逻辑中</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">幻舞梦境</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">幻舞梦境</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                    <li><a href="/archives">博客归档</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="https://github.com/ovwane" title="github">github</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-CentOS7 安装Python" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/08/CentOS7 安装Python/" class="article-date">
      <time datetime="2017-05-08T02:33:50.000Z" itemprop="datePublished">2017-05-08</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="安装Python"><a href="#安装Python" class="headerlink" title="安装Python"></a>安装Python</h2><h3 id="安装Python依赖"><a href="#安装Python依赖" class="headerlink" title="安装Python依赖"></a>安装Python依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># CentOS7</span><br><span class="line">yum install -y  gcc gcc-c++ make git patch openssl-devel zlib-devel readline-devel sqlite sqlite-devel bzip2-devel curl wget ncurses-devel sqlite-devel gdbm-devel xz-devel tk-devel</span><br></pre></td></tr></table></figure>
<h3 id="安装pyenv"><a href="#安装pyenv" class="headerlink" title="安装pyenv"></a>安装<a href="https://github.com/pyenv/pyenv" target="_blank" rel="noopener">pyenv</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/pyenv/pyenv.git ~/.pyenv</span><br></pre></td></tr></table></figure>
<h4 id="配置bash-profile"><a href="#配置bash-profile" class="headerlink" title="配置bash_profile"></a>配置bash_profile</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;export PYENV_ROOT=&quot;$HOME/.pyenv&quot;&apos; &gt;&gt; ~/.bashrc</span><br><span class="line">echo &apos;export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;&apos; &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br><span class="line">echo -e &apos;if command -v pyenv 1&gt;/dev/null 2&gt;&amp;1; then\n  eval &quot;$(pyenv init -)&quot;\nfi&apos; &gt;&gt; ~/.bashrc</span><br><span class="line"></span><br><span class="line">exec &quot;$SHELL&quot;</span><br></pre></td></tr></table></figure>
<h4 id="安装Python-1"><a href="#安装Python-1" class="headerlink" title="安装Python"></a>安装Python</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pyenv install 3.6.5 -v</span><br><span class="line"></span><br><span class="line">pyenv global 3.6.5</span><br><span class="line"></span><br><span class="line">pyenv rehash</span><br></pre></td></tr></table></figure>
<p>/root/.pyenv/versions/3.6.5/bin/python</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install virtualenvwrapper pipenv</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">start virtualwrapper</span></span><br><span class="line">VIRTUALENVWRAPPER_PYTHON=/root/.pyenv/versions/3.6.5/bin/python</span><br><span class="line">export WORKON_HOME='~/.virtualenv'</span><br><span class="line">source /root/.pyenv/versions/3.6.5/bin/virtualenvwrapper.sh</span><br><span class="line"><span class="meta">#</span><span class="bash">end</span></span><br></pre></td></tr></table></figure>
<p>pipenv –python=/root/.pyenv/versions/3.6.5/bin/python</p>
<p>因Supervisor现在不支持python3的版本需要安装Python 2.7.13</p>
<p>pyenv install 2.7.14 -v<br>pyenv global 2.7.14<br>pyenv rehash</p>
<h3 id="更改pypi源"><a href="#更改pypi源" class="headerlink" title="更改pypi源"></a>更改pypi源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 新建pip.conf存放目录</span><br><span class="line">mkdir ~/.pip&amp;&amp;cd ~/.pip</span><br><span class="line"></span><br><span class="line">cat &gt;pip.conf&lt;&lt;EOF</span><br><span class="line">[global]</span><br><span class="line">index-url = https://pypi.douban.com/simple</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Python相关的书签" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/03/Python相关的书签/" class="article-date">
      <time datetime="2017-05-03T03:24:43.000Z" itemprop="datePublished">2017-05-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="求职"><a href="#求职" class="headerlink" title="求职"></a>求职</h1><p><a href="https://groups.google.com/forum/m/#!topic/python-cn/JN_Q9o4t8ZM" target="_blank" rel="noopener">新人到底需要什么?</a></p>
<p><a href="https://www.zhihu.com/question/61103114" target="_blank" rel="noopener">Python 爬虫学到什么样就可以找工作了？</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/30518284" target="_blank" rel="noopener">我是如何从自学编程到找到工作的</a></p>
<p><a href="https://www.zhihu.com/question/29775447" target="_blank" rel="noopener">有多少人按@萧井陌大神给出的Python+Flask路线找到工作了？</a></p>
<p>现在看的爬虫代码，学会了就可以找工作了</p>
<h3 id="Python爬虫面试题"><a href="#Python爬虫面试题" class="headerlink" title="Python爬虫面试题"></a>Python爬虫面试题</h3><p><a href="https://github.com/taizilongxu/interview_python" target="_blank" rel="noopener">关于Python的面试题</a></p>
<p><a href="https://www.cnblogs.com/super-super-/p/7545952.html" target="_blank" rel="noopener">Python爬虫面试（2017.09.18）</a></p>
<p><a href="http://www.cnblogs.com/skiler/category/1008825.html" target="_blank" rel="noopener">Python面试与分析</a></p>
<p><a href="http://www.lqkweb.com/blog.php?id=91" target="_blank" rel="noopener">python工程师四家公司面试题</a></p>
<p><a href="https://halshaw.github.io/2016/11/13/%E6%88%91%E7%9A%84%E9%9D%A2%E8%AF%95%E4%B9%8B%E6%97%85/" target="_blank" rel="noopener">我的面试之旅</a></p>
<p><a href="https://www.zhihu.com/collection/160863281" target="_blank" rel="noopener">python爬虫相关</a></p>
<p><a href="http://blog.csdn.net/YLBF_DEV/article/details/51479449" target="_blank" rel="noopener">Python 爬虫的工具列表( 附Github代码下载链接)</a></p>
<p><a href="https://github.com/lining0806/PythonSpiderNotes" target="_blank" rel="noopener">Python入门网络爬虫之精华版</a></p>
<p><a href="https://github.com/shfanzie/Systematically_self-study_Python" target="_blank" rel="noopener">Systematically_self-study_Python</a></p>
<p><a href="https://github.com/taizilongxu" target="_blank" rel="noopener">hackerxu</a></p>
<h1 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h1><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>胡阳<br><a href="https://www.the5fire.com/" target="_blank" rel="noopener">the5fire的技术博客</a></p>
<p>廖雪峰<br><a href="https://www.liaoxuefeng.com/" target="_blank" rel="noopener">廖雪峰的官方网站</a></p>
<p>董伟明<br><a href="http://www.dongwm.com/" target="_blank" rel="noopener">小明明s à domicile | Python之美</a></p>
<p>Alex Li<br><a href="http://www.cnblogs.com/alex3714/articles/5885096.html" target="_blank" rel="noopener">金角大王等待唐僧的日子-老男孩教育Python自动化2.0课程课件目录</a></p>
<p>零度<br><a href="https://nyloner.cn/" target="_blank" rel="noopener">零度</a><br><a href="https://nyloner.cn/categorys?key=%E7%88%AC%E8%99%AB" target="_blank" rel="noopener">零度-文章-爬虫</a></p>
<p><a href="http://ictar.github.io/" target="_blank" rel="noopener">Ele - A面</a></p>
<h2 id="python爬虫-amp-amp-数据挖掘"><a href="#python爬虫-amp-amp-数据挖掘" class="headerlink" title="python爬虫&amp;&amp;数据挖掘"></a>python爬虫&amp;&amp;数据挖掘</h2><p>十四君<br><a href="https://www.urlteam.org/category/web_crawlers/" target="_blank" rel="noopener">URl-team python爬虫&amp;&amp;数据挖掘</a></p>
<p>崔庆才<br><a href="https://cuiqingcai.com/" target="_blank" rel="noopener">静觅 崔庆才的个人博客</a><br><a href="https://ask.hellobi.com/blog/cuiqingcai" target="_blank" rel="noopener">崔庆才的个人博客-hellobi</a></p>
<p>州的先生<br><a href="http://zmister.com/" target="_blank" rel="noopener">州的先生</a></p>
<p>Ehco Blog<br><a href="http://www.ehcoblog.ml/" target="_blank" rel="noopener">Ehco Blog</a></p>
<p>Authors: A. Jesse Jiryu Davis and Guido van Rossum<br><a href="https://github.com/aosabook/500lines/tree/master/crawler" target="_blank" rel="noopener">aosabook/500lines</a></p>
<h2 id="数据挖掘"><a href="#数据挖掘" class="headerlink" title="数据挖掘"></a>数据挖掘</h2><p><a href="http://www.lining0806.com/" target="_blank" rel="noopener">宁哥的小站</a></p>
<p>#HTTP<br>HTTP POST参数</p>
<p><a href="https://www.zhihu.com/question/60256922/answer/174211193" target="_blank" rel="noopener">Python爬虫传送post请求要携带哪些参数?</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/27097051" target="_blank" rel="noopener">60秒GET小技能-爬虫快速构建post参数法</a></p>
<p>#破解<br><a href="blog.csdn.net/paololiu/article/details/52514504">破解极验(geetest)验证码 - CSDN博客</a></p>
<p>#数据可视化<br><a href="https://www.jianshu.com/p/19f1e63bfe2b" target="_blank" rel="noopener">有趣的数据可视化 - 简书</a></p>
<p>#人工<br>SnailTyan<br><a href="http://noahsnail.com/" target="_blank" rel="noopener">SnailTyan</a></p>
<h1 id="Python文档"><a href="#Python文档" class="headerlink" title="Python文档"></a>Python文档</h1><p><a href="python.usyiyi.cn">Python一译中文文档</a></p>
<h1 id="Python小技巧"><a href="#Python小技巧" class="headerlink" title="Python小技巧"></a>Python小技巧</h1><p><a href="https://www.cnblogs.com/hanxiaoyi/p/7745003.html" target="_blank" rel="noopener">python奇技淫巧</a></p>
<p>Python 3.X 里不包含字典类型的has_key() 函数，被 <strong>contains</strong>(key) 替代</p>
<p>Django</p>
<p><a href="https://github.com/Nyloner/NyBlog" target="_blank" rel="noopener">Nyloner/NyBlog</a></p>
<h3 id="Python-FAQ"><a href="#Python-FAQ" class="headerlink" title="Python FAQ"></a>Python FAQ</h3><p><a href="http://ictar.github.io/2016/11/19/%E4%B8%80%E6%AC%A1%E6%8A%93%E8%99%AB%E5%BC%95%E5%8F%91%E7%9A%84%E5%AF%B9python%E5%AF%BC%E5%85%A5%E6%9C%BA%E5%88%B6%E7%9A%84%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86/" target="_blank" rel="noopener">一次抓虫引发的对python导入机制的初步认识</a></p>
<h3 id="编程指南"><a href="#编程指南" class="headerlink" title="编程指南"></a>编程指南</h3><p><a href="https://zhuanlan.zhihu.com/p/19959253" target="_blank" rel="noopener">编程入门指南 v1.5</a></p>
<p><a href="http://blog.csdn.net/a910626/article/details/45223657" target="_blank" rel="noopener">知乎萧井陌大神《编程入门指南v1.3》思维导图</a></p>
<p><a href="https://zhu327.github.io/2016/06/16/python%E5%8D%8F%E7%A8%8B/" target="_blank" rel="noopener">Python协程</a></p>
<p><a href="http://www.dongwm.com/archives/%E4%BD%BF%E7%94%A8Python%E8%BF%9B%E8%A1%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-asyncio%E7%AF%87/" target="_blank" rel="noopener">使用Python进行并发编程-asyncio篇(一)</a></p>
<p><a href="https://github.com/aio-libs" target="_blank" rel="noopener">aio-libs</a></p>
<p><a href="http://aosabook.org/en/500L/a-web-crawler-with-asyncio-coroutines.html" target="_blank" rel="noopener">A Web Crawler With asyncio Coroutines<br>A. Jesse Jiryu Davis and Guido van Rossum</a></p>
<h3 id="性能调试"><a href="#性能调试" class="headerlink" title="性能调试"></a>性能调试</h3><p><a href="https://zhuanlan.zhihu.com/p/28078824" target="_blank" rel="noopener">Python web 应用性能调优</a></p>
<p><a href="https://mp.weixin.qq.com/s/_azeNFiDsFpEs_lWO0mH_A" target="_blank" rel="noopener">http服务跟踪及调试工具</a></p>
<p><a href="https://github.com/uber/pyflame" target="_blank" rel="noopener">Pyflame: A Ptracing Profiler For Python</a></p>
<p>FAQ</p>
<p><a href="https://zhuanlan.zhihu.com/p/32446353" target="_blank" rel="noopener">Supervisor 的问题 minfds</a></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-难难难" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/02/难难难/" class="article-date">
      <time datetime="2017-05-02T09:19:37.000Z" itemprop="datePublished">2017-05-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/02/难难难/">难难难</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-难难难，Kubernetes" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/02/难难难，Kubernetes/" class="article-date">
      <time datetime="2017-05-02T09:19:12.000Z" itemprop="datePublished">2017-05-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/02/难难难，Kubernetes/">难难难，Kubernetes</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Resin+Nginx动静分离和负载均衡" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/02/Resin+Nginx动静分离和负载均衡/" class="article-date">
      <time datetime="2017-05-02T03:43:54.000Z" itemprop="datePublished">2017-05-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/02/Resin+Nginx动静分离和负载均衡/">Resin+Nginx动静分离和负载均衡</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><a href="http://renzhiyuan.blog.51cto.com/10433137/1897612" target="_blank" rel="noopener">Resin+Nginx动静分离和负载均衡</a></p>
<p>案例：目前很多人喜欢Nginx+tomcat动静分离，或者反代后端tomcat集群，不过很多人也喜欢用Resin。<br>本人花了些功夫总结了Resin和tomcat区别：</p>
<table>
<thead>
<tr>
<th>特性\容器</th>
<th>resin</th>
<th>tomcat</th>
</tr>
</thead>
<tbody>
<tr>
<td>公司</td>
<td>CAUCHO</td>
<td>Apache</td>
</tr>
<tr>
<td>是否收费</td>
<td>不完全免费（pro版本收费）</td>
<td>完全免费</td>
</tr>
<tr>
<td>Eclipse下调试开发</td>
<td>适中</td>
<td>复杂</td>
</tr>
<tr>
<td>性能</td>
<td>轻量级,pro版本支持负载均衡，以及缓存功能</td>
<td>轻量级(NIO模式性能高些）,支持负载均衡</td>
</tr>
<tr>
<td>多实例</td>
<td>略麻烦</td>
<td>比较简单</td>
</tr>
<tr>
<td>集群部署</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>是否支持php</td>
<td>新版本支持（但很少用）</td>
<td>默认不支持（可配置）</td>
</tr>
<tr>
<td>用户喜好</td>
<td>略少</td>
<td>略多</td>
</tr>
<tr>
<td>常用组合</td>
<td>Nginx+Resin or+其它</td>
<td>Nginx+tomcat+or其它</td>
</tr>
<tr>
<td>报错机制</td>
<td>简单</td>
<td>复杂</td>
</tr>
<tr>
<td>标准&#124;开发&#124;行为喜好</td>
<td>两者在标准支持，开发使用，用户喜好有很大关系</td>
</tr>
</tbody>
</table>
<p>常用JavaEE容器有很多:Tomcat、Resin、JBoss、Glassfish ，注意weblogic属于应用服务器。</p>
<p>1、安装配置Resin：<br>1.1）jdk目录创建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@resin ~]# tar zxvfjdk-7u75-linux-x64.tar.gz</span><br><span class="line">[root@resin ~]# mkdir/usr/local/jdk1.7</span><br><span class="line">[root@resin ~]# mvjdk1.7.0_75/* /usr/local/jdk1.7/</span><br><span class="line">[root@resin ~]# cat/etc/profile.d/jdk.sh </span><br><span class="line">export JAVA_HOME=/usr/local/jdk1.7/</span><br><span class="line">exportCLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">exportPATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">export JAVA_HOMECLASSPATH PATH</span><br></pre></td></tr></table></figure>
<p>1.2）Resin安装配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@resin ~]# yum install ntpdate -y</span><br><span class="line">[root@resin~]# ntpdate time.windows.com安装resin</span><br><span class="line">[root@resin~]# tar xf resin-4.0.50.tar.gz -C /usr/local/</span><br><span class="line">[root@resin~]# cd /usr/local</span><br><span class="line">[root@resin~]# #./configure --prefix=/usr/local/resin</span><br><span class="line">[root@resin~]# #make</span><br><span class="line">[root@resin ~]# #make install</span><br><span class="line">[root@resin local]# ln -s resin-4.0.50 resin</span><br><span class="line">[root@resin local]#cat / etc/profile.d/resin.sh </span><br><span class="line">exportRESIN_HOME=/usr/local/resin</span><br><span class="line">[root@resin local]#</span><br><span class="line">[root@resin local]#cp /usr/local/resin/bin/resin.sh /etc/init.d/resin</span><br><span class="line">[root@resin local]#chmod +x /etc/init.d/resin</span><br><span class="line">[root@resin local]#/etc/init.d/resin start</span><br></pre></td></tr></table></figure>
<p>1.3）首页访问：<br>HTTP://IP:8080</p>
<p>1.4）配置多个项目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@resin ~]# cd /usr/local/resin/conf</span><br><span class="line">[root@resin conf]# vim resin.xml</span><br><span class="line">#配置多个项目：</span><br><span class="line">&lt;clusterid=&quot;app1&quot;&gt;</span><br><span class="line">&lt;!-- define the servers in the cluster --&gt;</span><br><span class="line">&lt;server-multiid-prefix=&quot;app1&quot;address-list=&quot;$&#123;app1_servers&#125;&quot;port=&quot;6800&quot;/&gt;  //端口1</span><br><span class="line">&lt;!-- the default host, matching any host name --&gt;</span><br><span class="line">&lt;hostid=&quot;&quot;root-directory=&quot;.&quot;&gt;</span><br><span class="line">&lt;web-appid=&quot;/&quot;root-directory=&quot;/usr/local/resin/webapps/app1&quot;/&gt;   //项目1</span><br><span class="line">&lt;/host&gt;</span><br><span class="line">&lt;/cluster&gt;</span><br><span class="line">&lt;clusterid=&quot;app2&quot;&gt;</span><br><span class="line">&lt;!-- define the servers in the cluster --&gt;</span><br><span class="line">&lt;server-multiid-prefix=&quot;app2&quot;address-list=&quot;$&#123;app2_servers&#125;&quot;port=&quot;6801&quot;/&gt; //端口2</span><br><span class="line">&lt;!-- the default host, matching any host name --&gt;</span><br><span class="line">&lt;hostid=&quot;&quot;root-directory=&quot;.&quot;&gt;</span><br><span class="line">&lt;web-appid=&quot;/&quot;root-directory=&quot;/usr/local/resin/webapps/app2&quot;/&gt; //项目2</span><br><span class="line">&lt;/host&gt;</span><br><span class="line">&lt;/cluster&gt;</span><br></pre></td></tr></table></figure>
<p>1.4.1）定义端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># app-tier Triad servers: app-0 app-1 app-2 </span><br><span class="line">app1_servers      : 127.0.0.1:6800 </span><br><span class="line">app2_servers      : 127.0.0.1:6801 </span><br><span class="line">app1.http          : 8080 </span><br><span class="line">app2.http          : 8081</span><br></pre></td></tr></table></figure>
<p>1.5）JDBC配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;database&gt;</span><br><span class="line">&lt;jndi-name&gt;jdbc/test&lt;/jndi-name&gt;</span><br><span class="line">&lt;driver type=&quot;com.microsoft.jdbc.sqlserver.SQLServerDriver&quot;&gt;</span><br><span class="line">&lt;url&gt;jdbc:microsoft:sqlserver://localhost:3306;databasename=Northwind&lt;/url&gt;  //后端数据库</span><br><span class="line">&lt;user&gt;sa&lt;/user&gt;</span><br><span class="line">&lt;password&gt;password&lt;/password&gt;  //密码</span><br><span class="line">&lt;/driver&gt;</span><br><span class="line">&lt;prepared-statement-cache-size&gt;8&lt;/prepared-statement-cache-size&gt;</span><br><span class="line">&lt;max-connections&gt;20&lt;/max-connections&gt;</span><br><span class="line">&lt;max-idle-time&gt;30s&lt;/max-idle-time&gt;</span><br><span class="line">&lt;/database&gt;</span><br></pre></td></tr></table></figure>
<p>注意：jdbc文件可自己定义，需要导入相应的驱动包。</p>
<p>2、安装配置Nginx：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd nginx -M -s /sbin/nologin</span><br><span class="line">tar xf nginx-1.9.2.tar.gz</span><br><span class="line">cd nginx-1.9.2</span><br><span class="line">./configure --user=nginx --group=nginx --prefix=/usr/local/nginx  --with-http_stub_status_module--with-http_ssl_module --with-http_realip_module  --with-http_flv_module --with-http_mp4_module --with-http_gzip_static_module&amp;&amp;make &amp;&amp;make install</span><br></pre></td></tr></table></figure>
<p>2.1）nginx.conf配置负载均衡：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">user  nginx; </span><br><span class="line"> </span><br><span class="line">worker_processes  8;</span><br><span class="line"> </span><br><span class="line">#worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 10000000;</span><br><span class="line"> </span><br><span class="line">error_log  logs/error.log  info;</span><br><span class="line"> </span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"> </span><br><span class="line">events &#123;</span><br><span class="line">use epoll;</span><br><span class="line">worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">http &#123;</span><br><span class="line">include       mime.types;</span><br><span class="line"> </span><br><span class="line">default_type  application/octet-stream;</span><br><span class="line"> </span><br><span class="line">charset UTF-8;</span><br><span class="line"> </span><br><span class="line">server_names_hash_bucket_size 128;</span><br><span class="line"> </span><br><span class="line">client_header_buffer_size 32k;</span><br><span class="line"> </span><br><span class="line">large_client_header_buffers 4 32k;</span><br><span class="line"> </span><br><span class="line">client_max_body_size 8m;</span><br><span class="line"> </span><br><span class="line">#limit_conn_zone $binary_remote_addr zone=one:32k;</span><br><span class="line">#limit_conn_zone $binary_remote_addr zone=permitip:10m;</span><br><span class="line"> </span><br><span class="line">error_page   404 =  http://www.jb51.net/404.html;</span><br><span class="line"> </span><br><span class="line">#error_page   404  = /40x.html;</span><br><span class="line">#location = /40x.html&#123;</span><br><span class="line">#root   html;</span><br><span class="line">#&#125;</span><br><span class="line"> </span><br><span class="line">#error_page   500 502 503 504  /50x.html;</span><br><span class="line">#location = /50x.html &#123;</span><br><span class="line">#root   html;</span><br><span class="line">#&#125;</span><br><span class="line"> </span><br><span class="line">open_file_cache max=102400 inactive=20s;</span><br><span class="line"> </span><br><span class="line">sendfile        on;</span><br><span class="line"> </span><br><span class="line">#autoindex on;</span><br><span class="line"> </span><br><span class="line">tcp_nopush  on;</span><br><span class="line">tcp_nodelay on;</span><br><span class="line"> </span><br><span class="line">keepalive_timeout  60;</span><br><span class="line"> </span><br><span class="line">gzip  on;</span><br><span class="line">gzip_min_length  1k;</span><br><span class="line">gzip_buffers     4 16k;</span><br><span class="line">gzip_http_version 1.0;</span><br><span class="line">gzip_comp_level 2;</span><br><span class="line">#gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line">gzip_vary on;</span><br><span class="line"> </span><br><span class="line">fastcgi_connect_timeout 300;</span><br><span class="line">fastcgi_send_timeout 300;</span><br><span class="line">fastcgi_read_timeout 300;</span><br><span class="line">fastcgi_buffer_size 64k;</span><br><span class="line">fastcgi_buffers 4 64k;</span><br><span class="line">fastcgi_busy_buffers_size 128k;</span><br><span class="line">fastcgi_temp_file_write_size 128k;</span><br><span class="line"> </span><br><span class="line">#如果要启用负载均衡</span><br><span class="line">#upstream www.xxx.com &#123;    </span><br><span class="line">#zone myapp1 64k; </span><br><span class="line">#server 192.168.1.220:80 weight=1 max_fails=2 fail_timeout=30s slow_start=30s; </span><br><span class="line">#server 192.168.1.221:80 weight=1 max_fails=2 fail_timeout=30s;   </span><br><span class="line">#&#125; </span><br><span class="line">   </span><br><span class="line">#upstream www.xxx.org &#123;   </span><br><span class="line">#zone myapp1 64k; </span><br><span class="line">#server 192.168.1.220:80 weight=1 max_fails=2 fail_timeout=30s slow_start=30s; </span><br><span class="line">#server 192.168.1.221:80 weight=1 max_fails=2 fail_timeout=30s;   </span><br><span class="line">#&#125;   </span><br><span class="line">log_format  access &apos;$remote_addr - $remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&apos;;</span><br><span class="line"> </span><br><span class="line">#access_log logs/access.log access;</span><br><span class="line"> </span><br><span class="line">include vhost/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.2）renzhiyuan.conf配置动静分离：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  </span><br><span class="line">        #路径根据 Resin定义路径配置，这里根据默认</span><br><span class="line">        root   /usr/local/resin/webapps/ROOT;  </span><br><span class="line">        index  index.html index.php index.jsp index.html;</span><br><span class="line">         </span><br><span class="line">#location ~ \.php$ &#123;</span><br><span class="line">#            root           html;</span><br><span class="line">#            fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">#            fastcgi_index  index.php;</span><br><span class="line">#            include        fastcgi.conf;</span><br><span class="line">#        &#125;</span><br><span class="line">         </span><br><span class="line">location ~ .(jsp|jspx|do)?$ &#123;</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_pass http://127.0.0.1:8080;</span><br><span class="line">proxy_redirect off;</span><br><span class="line"> </span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">client_max_body_size 10m; </span><br><span class="line">client_body_buffer_size 128k;</span><br><span class="line">proxy_connect_timeout 90;</span><br><span class="line">proxy_send_timeout 90;</span><br><span class="line">proxy_read_timeout 90;</span><br><span class="line">proxy_buffer_size 4k;</span><br><span class="line">proxy_buffers 4 32k;</span><br><span class="line">proxy_busy_buffers_size 64k;</span><br><span class="line">proxy_temp_file_write_size 64k;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">location ~ .*\.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$ &#123;</span><br><span class="line">expires      30d;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">location ~ .*\.(js|css)?$ &#123;</span><br><span class="line">expires      12h;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/技术/">技术</a><a class="article-category-link" href="/categories/技术/Linux/">Linux</a>
    </div>


      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CentOS/">CentOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Resin/">Resin</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Python分布式爬虫打造搜索引擎-学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/01/Python分布式爬虫打造搜索引擎-学习笔记/" class="article-date">
      <time datetime="2017-05-01T12:18:02.000Z" itemprop="datePublished">2017-05-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/01/Python分布式爬虫打造搜索引擎-学习笔记/">Python分布式爬虫打造搜索引擎-学习笔记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>第1章 课程介绍<br>第2章 Windows下搭建开发环境<br>第3章 爬虫基础知识回顾<br>第4章 Scrapy爬取知名技术文章网站<br>第5章 Scrapy爬取知名问答网站<br>第6章 通过CrawlSpider对招聘网站进行整站爬取<br>第7章 Scrapy突破反爬虫的限制<br>第8章 Scrapy进阶开发<br>第9章 Scrapy-redis分布式爬虫<br>第10章 Elasticsearch搜索引擎的使用<br>第11章 Django搭建搜索网站<br>第12章 Scrapyd部署Scrapy爬虫<br>第13章 课程总结</p>
<h1 id="第1章-课程介绍"><a href="#第1章-课程介绍" class="headerlink" title="第1章 课程介绍"></a>第1章 课程介绍</h1><p>1-1 python分布式爬虫打造搜索引擎简介.mp4 07:31</p>
<h1 id="第2章-Windows下搭建开发环境"><a href="#第2章-Windows下搭建开发环境" class="headerlink" title="第2章 Windows下搭建开发环境"></a>第2章 Windows下搭建开发环境</h1><p>2-1 pycharm的安装和简单使用.mp4 10:28<br>2-2 mysql和navicat的安装和使用.mp4 16:21<br>2-3 windows和linux下安装python2和python3.mp4 06:49<br>2-4 虚拟环境的安装和配置.mp4 30:53</p>
<h1 id="第3章-爬虫基础知识回顾"><a href="#第3章-爬虫基础知识回顾" class="headerlink" title="第3章 爬虫基础知识回顾"></a>第3章 爬虫基础知识回顾</h1><p>3-1 技术选型 爬虫能做什么(1-2)(第2节09分钟58秒).mp4 28:37<br>3-3 正则表达式-2(3-4)(第4节16分钟00秒).mp4 32:23<br>3-5 深度优先和广度优先原理.mp4 25:27<br>3-6 url去重方法(7-6)(第6节15分钟20秒).mp4 23:28</p>
<h1 id="第4章-Scrapy爬取知名技术文章网站"><a href="#第4章-Scrapy爬取知名技术文章网站" class="headerlink" title="第4章 Scrapy爬取知名技术文章网站"></a>第4章 Scrapy爬取知名技术文章网站</h1><p>4-1 scrapy安装以及目录结构介绍(1-3).mp4 57:25<br>4-4 xpath的用法 - 2(4-5).mp4 32:41<br>4-6 css选择器实现字段解析 - 1(6-7).mp4 27:23<br>4-7 css选择器实现字段解析 - 2(7-15).mp4 2:24:38<br>4-8 编写spider爬取jobbole的所有文章 - 1(8-9) .mp4 20:38<br>4-16 scrapy item loader机制 - 1.mp4 17:26<br>4-17 scrapy item loader机制- 2.mp4 31:28</p>
<h1 id="第5章-Scrapy爬取知名问答网站"><a href="#第5章-Scrapy爬取知名问答网站" class="headerlink" title="第5章 Scrapy爬取知名问答网站"></a>第5章 Scrapy爬取知名问答网站</h1><p>5-1 session和cookie自动登录机制(1-5).mp4 1:20:08<br>5-6 知乎分析以及数据表设计1(6-16).mp4 2:46:21<br>5-17 (补充小节)知乎验证码登录 - 2_1.mp4 10:32</p>
<h1 id="第6章-通过CrawlSpider对招聘网站进行整站爬取"><a href="#第6章-通过CrawlSpider对招聘网站进行整站爬取" class="headerlink" title="第6章 通过CrawlSpider对招聘网站进行整站爬取"></a>第6章 通过CrawlSpider对招聘网站进行整站爬取</h1><p>6-1 数据表结构设计(1-4).mp4 1:08:21<br>6-5 item loader方式解析职位(5-7) 7-1(1).mp4 1:15:24</p>
<h1 id="第7章-Scrapy突破反爬虫的限制"><a href="#第7章-Scrapy突破反爬虫的限制" class="headerlink" title="第7章 Scrapy突破反爬虫的限制"></a>第7章 Scrapy突破反爬虫的限制</h1><p>7-2 scrapy架构源码分析(2-10).mp4 2:18:32</p>
<h1 id="第8章-Scrapy进阶开发"><a href="#第8章-Scrapy进阶开发" class="headerlink" title="第8章 Scrapy进阶开发"></a>第8章 Scrapy进阶开发</h1><p>8-1 selenium动态网页请求与模拟登录知乎.mp4 21:30<br>8-2 selenium模拟登录微博， 模拟鼠标下拉.mp4 11:08<br>8-3 chromedriver不加载图片、phantomjs获取动态网页.mp4 10:04<br>8-4 selenium集成到scrapy中.mp4 16:30<br>8-5 其余动态网页获取技术介绍-chrome无界面运行、scrapy-splash、selenium-grid, splinter.mp4 08:01<br>8-6 scrapy的暂停与重启.mp4 10:17<br>8-7 scrapy url去重原理.mp4 05:52<br>8-8 scrapy telnet服务.mp4 07:00<br>8-9 spider middleware 详解.mp4 10:46<br>8-10 scrapy的数据收集.mp4 10:40<br>8-12 scrapy扩展开发.mp4 11:52</p>
<h1 id="第9章-Scrapy-redis分布式爬虫"><a href="#第9章-Scrapy-redis分布式爬虫" class="headerlink" title="第9章 Scrapy-redis分布式爬虫"></a>第9章 Scrapy-redis分布式爬虫</h1><p>9-1 分布式爬虫要点.mp4 08:59<br>9-2 redis基础知识 - 1.mp4 16:29<br>9-3 redis基础知识 - 2.mp4 20:37<br>9-5 scrapy源码解析-connection.py、defaults.py-.mp4 05:51<br>9-6 scrapy-redis源码剖析-dupefilter.py-.mp4 05:57<br>9-7 scrapy-redis源码剖析- pipelines.py、 queue.py-.mp4 11:19</p>
<h1 id="第10章-Elasticsearch搜索引擎的使用"><a href="#第10章-Elasticsearch搜索引擎的使用" class="headerlink" title="第10章 Elasticsearch搜索引擎的使用"></a>第10章 Elasticsearch搜索引擎的使用</h1><p>10-1 elasticsearch介绍.mp4 16:34<br>10-2安装.mp4 13:40<br>10-3.mp4 26:45<br>10-4.mp4 11:34<br>10-5倒排索引.mp4 11:06<br>10-6.mp4 19:00<br>10-7.mp4 12:47<br>10-8.mp4 21:04<br>10-9.mp4 15:00<br>10-10.mp4 11:15<br>10-11.mp4 23:00<br>10-12.mp4 14:18<br>10-13.mp4 11:18</p>
<h1 id="第11章-Django搭建搜索网站"><a href="#第11章-Django搭建搜索网站" class="headerlink" title="第11章 Django搭建搜索网站"></a>第11章 Django搭建搜索网站</h1><p>11-1 es完成搜索建议.mp4 14:00<br>11-2.mp4 14:09<br>11-3.mp4 19:52<br>11-4.mp4 18:45<br>11-5.mp4 13:01<br>11-6.mp4 13:19<br>11-7.mp4 09:18</p>
<h1 id="第12章-Scrapyd部署Scrapy爬虫"><a href="#第12章-Scrapyd部署Scrapy爬虫" class="headerlink" title="第12章 Scrapyd部署Scrapy爬虫"></a>第12章 Scrapyd部署Scrapy爬虫</h1><p>12-1 scrapyd部署scrapy项目.mp4 19:10</p>
<h1 id="第13章-课程总结"><a href="#第13章-课程总结" class="headerlink" title="第13章 课程总结"></a>第13章 课程总结</h1><p>ArticleSpider运行环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipenv --python=three</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install scrapy redis pillow mysqlclient elasticsearch_dsl</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import MySQLdb</span><br></pre></td></tr></table></figure>
<p>ModuleNotFoundError: No module named ‘MySQLdb’</p>
<h1 id="Python分布式爬虫打造搜索引擎"><a href="#Python分布式爬虫打造搜索引擎" class="headerlink" title="Python分布式爬虫打造搜索引擎"></a>Python分布式爬虫打造搜索引擎</h1><p><a href="http://coding.imooc.com/class/chapter/92.html" target="_blank" rel="noopener">Python分布式爬虫打造搜索引擎</a><a href="http://www.projectsedu.com/" title="Bobby老师的博客" target="_blank" rel="noopener">聚学在线</a><br>Windows(Python 3.5.3 Python 2.7.13)<br>Linux(Python 3.5.2+ Python 2.7.12+)<br>大神们写的笔记：<br><a href="http://www.cnblogs.com/jinxiao-pu/p/6706319.html" target="_blank" rel="noopener">今孝</a><a href="http://www.jianshu.com/p/23b6d6b57ec5" target="_blank" rel="noopener">天涯明月笙</a><a href="http://blog.csdn.net/qq_23079443/article/details/73920584" target="_blank" rel="noopener">天涯明月笙-CSDN</a></p>
<blockquote>
<p>一盏灯， 一片昏黄； 一简书， 一杯淡茶。 守着那一份淡定， 品读属于自己的寂寞。 保持淡定， 才能欣赏到最美丽的风景！ 保持淡定， 人生从此不再寂寞。</p>
</blockquote>
<h2 id="第1章-课程介绍-1"><a href="#第1章-课程介绍-1" class="headerlink" title="第1章 课程介绍"></a>第1章 课程介绍</h2><p>介绍课程目标、通过课程能学习到的内容、和系统开发前需要具备的知识</p>
<h3 id="可以使用爬虫的业务"><a href="#可以使用爬虫的业务" class="headerlink" title="可以使用爬虫的业务"></a>可以使用爬虫的业务</h3><ul>
<li>互联网金融</li>
<li>数据建模</li>
<li>信息聚类</li>
<li>自然语言处理</li>
<li>医疗病例分析</li>
<li>数据分析服务</li>
</ul>
<h3 id="学习流程"><a href="#学习流程" class="headerlink" title="学习流程"></a>学习流程</h3><ol>
<li>环境配置和基础知识铺垫</li>
<li>爬取真实数据</li>
<li>scrapy突破反爬虫技术</li>
<li>scrapy进阶</li>
<li>scrapy redis 分布式爬虫</li>
<li>elasticsearch django实现搜索引擎</li>
</ol>
<h3 id="详细课程信息"><a href="#详细课程信息" class="headerlink" title="详细课程信息"></a>详细课程信息</h3><h4 id="爬虫基础知识"><a href="#爬虫基础知识" class="headerlink" title="爬虫基础知识"></a>爬虫基础知识</h4><ol>
<li>正则表达式</li>
<li>深度优先和广度优先遍历算法</li>
<li>url去重的常见策略</li>
</ol>
<h4 id="Scrapy-爬取三个不同类型的网站"><a href="#Scrapy-爬取三个不同类型的网站" class="headerlink" title="Scrapy 爬取三个不同类型的网站"></a>Scrapy 爬取三个不同类型的网站</h4><ul>
<li>知名技术社区-<a href="http://www.jobbole.com" target="_blank" rel="noopener">伯乐在线</a></li>
<li>知名问答网站-<a href="https://www.zhihu.com" target="_blank" rel="noopener">知乎</a></li>
<li>知名招聘网站-<a href="https://www.lagou.com" target="_blank" rel="noopener">拉钩</a></li>
</ul>
<h4 id="网站结构和网络请求分析"><a href="#网站结构和网络请求分析" class="headerlink" title="网站结构和网络请求分析"></a>网站结构和网络请求分析</h4><h4 id="xpath-css-提取数据"><a href="#xpath-css-提取数据" class="headerlink" title="xpath + css 提取数据"></a>xpath + css 提取数据</h4><h4 id="模拟登陆"><a href="#模拟登陆" class="headerlink" title="模拟登陆"></a>模拟登陆</h4><h4 id="Scrapy模块"><a href="#Scrapy模块" class="headerlink" title="Scrapy模块"></a>Scrapy模块</h4><p>spider<br>item<br>item loader<br>pipeline<br>feed export<br>CrawlSpider</p>
<h4 id="突破爬虫限制"><a href="#突破爬虫限制" class="headerlink" title="突破爬虫限制"></a>突破爬虫限制</h4><ul>
<li>图片验证码 网络打码平台</li>
<li>ip访问频繁限制 代理池</li>
<li>user-agent随机切换</li>
</ul>
<h4 id="Scrapy进阶开发"><a href="#Scrapy进阶开发" class="headerlink" title="Scrapy进阶开发"></a>Scrapy进阶开发</h4><ul>
<li>scrapy的原理</li>
<li>基于scrapy的中间件开发</li>
<li>动态网站的抓取处理</li>
<li>将selenium和phantomjs集成到scrapy中</li>
<li>scrapy log配置</li>
<li>email发送</li>
<li>scrapy信号</li>
</ul>
<h4 id="Scrapy-redis分布式爬虫"><a href="#Scrapy-redis分布式爬虫" class="headerlink" title="Scrapy-redis分布式爬虫"></a>Scrapy-redis分布式爬虫</h4><ul>
<li>理解scrapy-redis分布式爬虫</li>
<li>集成bloomfilter到scrapy-redis中</li>
</ul>
<h4 id="Django和Elasticsearch搭建一套搜索引擎"><a href="#Django和Elasticsearch搭建一套搜索引擎" class="headerlink" title="Django和Elasticsearch搭建一套搜索引擎"></a>Django和Elasticsearch搭建一套搜索引擎</h4><h3 id="课程体验-看完之后可以学会的技能"><a href="#课程体验-看完之后可以学会的技能" class="headerlink" title="课程体验-看完之后可以学会的技能"></a>课程体验-看完之后可以学会的技能</h3><ul>
<li>开发爬虫所需要用到的技术以及网站分析技巧</li>
<li>理解scrapy的原理和所有组件的使用以及分布式爬虫scrapy-redis的使用和原理</li>
<li>理解分布式开源搜索引擎elasticsearch的使用以及搜索引擎的原理</li>
<li>体验django如何快速搭建网站</li>
</ul>
<h2 id="第2章-Windows下搭建开发环境-1"><a href="#第2章-Windows下搭建开发环境-1" class="headerlink" title="第2章 Windows下搭建开发环境"></a>第2章 Windows下搭建开发环境</h2><p>介绍项目开发需要安装的开发软件、 python虚拟virtualenv和 virtualenvwrapper的安装和使用、 最后介绍pycharm和navicat的简单使用</p>
<h3 id="开发用到的工具软件"><a href="#开发用到的工具软件" class="headerlink" title="开发用到的工具软件"></a>开发用到的工具软件</h3><ol>
<li>IDE——PyCharm</li>
<li>数据库——MySQL、Redis、Elasticsearch</li>
<li>开发环境——pyenv、virtualenvwrapper</li>
</ol>
<h4 id="课程中用到的版本"><a href="#课程中用到的版本" class="headerlink" title="课程中用到的版本"></a>课程中用到的版本</h4><p>PyCharm 2016.3.2<br>Python 3.5.2+<br>MySQL 5.7.17<br>Navicat for MySQL</p>
<h3 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h3><ol>
<li>pycharm的安装和使用</li>
<li>mysql和navicat的安装和使用</li>
<li>virtualenv和virtualenvwrapper安装和配置</li>
<li>mysql 刷新权限命令，使root用户可以从所有IP远程连接。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;root@&apos;%&apos; IDENTIFIED BY &apos;root&apos; WITH GRANT OPTION; </span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="新建数据库"><a href="#新建数据库" class="headerlink" title="新建数据库"></a>新建数据库</h4><p>数据库名：scrapyspider<br>字符集：utf8 – UTF-8 Unicode<br>排序规则：utf8_general_ci</p>
<h4 id="新建数据表"><a href="#新建数据表" class="headerlink" title="新建数据表"></a>新建数据表</h4><p>数据表名：article</p>
<table>
<thead>
<tr>
<th>名</th>
<th>类型</th>
<th>长度</th>
<th>小数点</th>
<th>不是null</th>
<th>主键</th>
</tr>
</thead>
<tbody>
<tr>
<td>addtime</td>
<td>datetime</td>
<td>0</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>name</td>
<td>varchar</td>
<td>100</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>id</td>
<td>int</td>
<td>10</td>
<td>0</td>
<td>yes</td>
<td>1</td>
</tr>
</tbody>
</table>
<h4 id="macOS、Linux下Python安装-需要安装pyenv"><a href="#macOS、Linux下Python安装-需要安装pyenv" class="headerlink" title="macOS、Linux下Python安装-需要安装pyenv"></a>macOS、Linux下Python安装-需要安装<a href="https://github.com/pyenv/pyenv" target="_blank" rel="noopener">pyenv</a></h4><h5 id="Python-2-7-13"><a href="#Python-2-7-13" class="headerlink" title="Python 2.7.13"></a>Python 2.7.13</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pyenv install 2.7.13</span><br><span class="line">pyenv global 2.7.13</span><br><span class="line">pyenv <span class="built_in">rehash</span></span><br></pre></td></tr></table></figure>
<h5 id="Python-3-5-3"><a href="#Python-3-5-3" class="headerlink" title="Python 3.5.3"></a>Python 3.5.3</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pyenv install 3.5.3</span><br><span class="line">pyenv global 3.5.3</span><br><span class="line">pyenv <span class="built_in">rehash</span></span><br></pre></td></tr></table></figure>
<h4 id="virtualenvwrapper安装使用"><a href="#virtualenvwrapper安装使用" class="headerlink" title="virtualenvwrapper安装使用"></a>virtualenvwrapper安装使用</h4><h5 id="virtualenvwrapper安装"><a href="#virtualenvwrapper安装" class="headerlink" title="virtualenvwrapper安装"></a>virtualenvwrapper安装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.douban.com/simple/ virtualenvwrapper</span><br></pre></td></tr></table></figure>
<h5 id="virtualenvwrapper使用-需要配置环境变量"><a href="#virtualenvwrapper使用-需要配置环境变量" class="headerlink" title="virtualenvwrapper使用-需要配置环境变量"></a>virtualenvwrapper使用-需要配置环境变量</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 新建虚拟环境</span><br><span class="line">mkvirtualenv test</span><br><span class="line"># 新建虚拟环境-指定python版本</span><br><span class="line">mkvirtualenv test --python=/path/python</span><br><span class="line"># 使用虚拟环境</span><br><span class="line">workon test</span><br><span class="line"># 退出虚拟环境</span><br><span class="line">deactivate</span><br><span class="line"># 删除虚拟环境</span><br><span class="line">rmvirtualenv test</span><br></pre></td></tr></table></figure>
<p>NLPIR汉语分词系统</p>
<h2 id="第3章-爬虫基础知识回顾-1"><a href="#第3章-爬虫基础知识回顾-1" class="headerlink" title="第3章 爬虫基础知识回顾"></a>第3章 爬虫基础知识回顾</h2><p>介绍爬虫开发中需要用到的基础知识包括爬虫能做什么，正则表达式，深度优先和广度优先的算法及实现、爬虫url去重的策略、彻底弄清楚unicode和utf8编码的区别和应用。</p>
<h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><h4 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h4><ol>
<li>requests和beautifulsoup都是库，scrapy是框架</li>
<li>scrapy框架中可以加入requests和beautifulsoup</li>
<li>scrapy基于twisted，性能是最大的优势</li>
<li>scrapy方便扩展，提供了很多内置的功能</li>
<li>scrapy内置的css和xpath selector非常方便，beautifualsoup最大的缺点就是慢</li>
</ol>
<h4 id="网页分类"><a href="#网页分类" class="headerlink" title="网页分类"></a>网页分类</h4><ol>
<li>静态网页</li>
<li>动态网页</li>
<li>webservice（restapi）&gt;属于动态页面的一种</li>
</ol>
<h4 id="爬虫能做什么"><a href="#爬虫能做什么" class="headerlink" title="爬虫能做什么"></a>爬虫能做什么</h4><ol>
<li>搜索引擎—-百度、google、垂直领域搜索引擎</li>
<li>推荐引擎—-今日头条、一点资讯</li>
<li>机器学习的数据样本</li>
<li>数据分析(如金融数据分析)、舆情分析。</li>
</ol>
<h4 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h4><h5 id="正则表达式介绍"><a href="#正则表达式介绍" class="headerlink" title="正则表达式介绍"></a>正则表达式介绍</h5><ol>
<li>为什么必须学习正则表达式</li>
<li>正则表达式的简单应用及python示例</li>
</ol>
<h5 id="正则表达式基础"><a href="#正则表达式基础" class="headerlink" title="正则表达式基础"></a>正则表达式基础</h5><h6 id="1-特殊字符"><a href="#1-特殊字符" class="headerlink" title="1. 特殊字符"></a>1. 特殊字符</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1) ^ $ * ? + &#123;2&#125; &#123;2,&#125; &#123;2,5&#125; |</span><br><span class="line">2) [] [^] [a-z] .</span><br><span class="line">3) \s \S \w \W</span><br><span class="line">4) [\u4E00-\u9FA5] () \d</span><br></pre></td></tr></table></figure>
<h6 id="特殊字符含义"><a href="#特殊字符含义" class="headerlink" title="特殊字符含义"></a>特殊字符含义</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">^ 开头    &apos;^b.*&apos;----以b开头的任意字符</span><br><span class="line"></span><br><span class="line">$ 结尾    &apos;^b.*3$&apos;----以b开头，3结尾的任意字符</span><br><span class="line"></span><br><span class="line">* 任意长度（次数），≥0       </span><br><span class="line"></span><br><span class="line">? 非贪婪模式，非贪婪模式尽可能少的匹配所搜索的字符串 &apos;.*?(b.*?b).*&apos;----从左至右第一个b和的二个b之间的内容（包含b）</span><br><span class="line"></span><br><span class="line">+ 一次或多次</span><br><span class="line"></span><br><span class="line">&#123;2&#125; 指定出现次数2次</span><br><span class="line"></span><br><span class="line">&#123;2,&#125; 出现次数≥2次</span><br><span class="line"></span><br><span class="line">&#123;2,5&#125; 出现次数2≤x≤5</span><br><span class="line"></span><br><span class="line">| 或     例如，“z|food”能匹配“z”或“food”(此处请谨慎)。“[z|f]ood”则匹配“zood”或“food”。</span><br><span class="line"></span><br><span class="line">[] 中括号中任意一个符合即可（中括号里面没有分转义字符）   &apos;[abc]ooby123&apos;----只要开头符合[]中任意一个即可</span><br><span class="line"></span><br><span class="line">[^] 只要不出现[]中括号中的字符即可</span><br><span class="line"></span><br><span class="line">[a-Z] 从小a到大Z        &apos;1[48357][0-9]&#123;9&#125;&apos;----电话号码</span><br><span class="line"></span><br><span class="line">. 任意字符</span><br><span class="line"></span><br><span class="line">\s 匹配不可见字符 \n \t    &apos;你\s好&apos;----可以匹配‘你 好’</span><br><span class="line"></span><br><span class="line">\S 匹配可见字符，即普通字符</span><br><span class="line"></span><br><span class="line">\w 匹配下划线在内的任何单词字符</span><br><span class="line"></span><br><span class="line">\W 和上一个相反</span><br><span class="line"></span><br><span class="line">[\u4E00-\u9FA5] 只能匹配汉字</span><br><span class="line"></span><br><span class="line">() 要取出的信息就用括号括起来</span><br><span class="line"></span><br><span class="line">\d 数字</span><br></pre></td></tr></table></figure>
<h6 id="特殊字符实例"><a href="#特殊字符实例" class="headerlink" title="特殊字符实例"></a>特殊字符实例</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># "^"</span></span><br><span class="line">line = <span class="string">"bobby123"</span></span><br><span class="line">regex_str = <span class="string">"^a.*"</span> <span class="comment"># "^a"以a开头的字符串</span></span><br><span class="line"><span class="keyword">if</span> re.match(regex_str, line):</span><br><span class="line">	print(<span class="string">"yes"</span>)</span><br><span class="line">	</span><br><span class="line"><span class="comment"># "?"</span></span><br><span class="line">line = <span class="string">"boooooobby123"</span></span><br><span class="line"><span class="comment"># regex_str = ".*(b.*b).*" # 贪婪模式</span></span><br><span class="line">regex_str = <span class="string">".*?(b.*?b).*"</span> <span class="comment"># 非贪婪模式</span></span><br><span class="line">match_obj = re.match(regex_str, line)</span><br><span class="line"><span class="keyword">if</span> match_obj:</span><br><span class="line">	print(<span class="string">"yes"</span>)</span><br><span class="line"></span><br><span class="line">line = <span class="string">"XXX出生于2001年6月1日"</span></span><br><span class="line"><span class="comment">#line = "XXX出生于2001年6月"</span></span><br><span class="line"><span class="comment">#line = "XXX出生于2001/6/1"</span></span><br><span class="line"><span class="comment">#line = "XXX出生于2001-6-1"</span></span><br><span class="line"><span class="comment">#line = "XXX出生于2001-06-01"</span></span><br><span class="line"><span class="comment">#line = "XXX出生于2001-06"</span></span><br><span class="line"></span><br><span class="line">regex_str = <span class="string">".*出生于\d&#123;4&#125;[年/-]\d&#123;1,2&#125;([月/-]\d&#123;1,2&#125;日|[-/]\d&#123;1,2&#125;|$)"</span></span><br><span class="line">match_obj = re.match(regex_str, line)</span><br><span class="line"><span class="keyword">if</span> match_obj:</span><br><span class="line">    print(match_obj.group())</span><br></pre></td></tr></table></figure>
<p>爬取策略的深度优先和广度优先</p>
<p>爬虫网址去重策略</p>
<p>基础环境</p>
<blockquote>
<p>Python 3.6.5  <br><br>PyCharm 2017.3.4 <br><br>MariaDB <br><br>Navicat <br></p>
</blockquote>
<p><code>pip install scrapy</code></p>
<p>命令行创建scrapy项目</p>
<p><code>scrapy startproject ArticleSpider</code></p>
<p>scrapy目录结构</p>
<blockquote>
<p>scrapy.cfg</p>
</blockquote>
<p>配置文件</p>
<blockquote>
<p>setings.py<br>设置<br>SPIDER_MODULES = [‘ArticleSpider.spiders’] #存放spider的路径<br>NEWSPIDER_MODULE = ‘ArticleSpider.spiders’<br>pipelines.py:</p>
</blockquote>
<p>做跟数据存储相关的东西</p>
<blockquote>
<p>middilewares.py:</p>
</blockquote>
<p>自己定义的middlewares 定义方法，处理响应的IO操作</p>
<blockquote>
<p>init.py:</p>
</blockquote>
<p>项目的初始化文件。</p>
<blockquote>
<p>items.py：</p>
</blockquote>
<p>定义我们所要爬取的信息的相关属性。Item对象是种类似于表单，用来保存获取到的数据</p>
<p>创建我们的spider</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ArticleSpider</span><br><span class="line">scrapy genspider jobbole blog.jobbole.com</span><br></pre></td></tr></table></figure>
<p>scray在命令行启动Spyder的命令:</p>
<p><code>scrapy crawl jobbole</code></p>
<p>创建我们的调试工具类*</p>
<p>在项目根目录里创建main.py<br>作为调试工具文件</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy.cmdline <span class="keyword">import</span> execute</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#将系统当前目录设置为项目根目录</span></span><br><span class="line">sys.path.append(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">execute([<span class="string">"scrapy"</span>, <span class="string">"crawl"</span> , <span class="string">"jobbole"</span>])</span><br></pre></td></tr></table></figure>
<p>开启控制台调试</p>
<p><code>scrapy shell http://blog.jobbole.com/110287/</code></p>
<p>twist异步机制</p>
<p>Scrapy使用了Twisted作为框架，Twisted有些特殊的地方是它是事件驱动的，并且比较适合异步的代码。在任何情况下，都不要写阻塞的代码。阻塞的代码包括:</p>
<ul>
<li>访问文件、数据库或者Web</li>
<li>产生新的进程并需要处理新进程的输出，如运行shell命令</li>
<li>执行系统层次操作的代码，如等待系统队列</li>
</ul>
<h4 id="深度优先和广度优先"><a href="#深度优先和广度优先" class="headerlink" title="深度优先和广度优先"></a>深度优先和广度优先</h4><ol>
<li>网站的树结构</li>
<li>深度优先算法和实现—-递归</li>
<li>广度优先算法和实现—-队列</li>
</ol>
<h5 id="1-网站的树结构"><a href="#1-网站的树结构" class="headerlink" title="1. 网站的树结构"></a>1. 网站的树结构</h5><hr>
<p><a href="http://www.jobbole.com" target="_blank" rel="noopener">www.jobbole.com</a></p>
<hr>
<p>top.jobbole.com blog.jobbole.com python.jobbole.com android.jobbole.com</p>
<hr>
<p>top.jobbole.com/123<br>top.jobbole.com/456</p>
<p>blog.jobbole.com/123<br>blog.jobbole.com/456</p>
<hr>
<h5 id="2-深度优先算法和实现—-递归"><a href="#2-深度优先算法和实现—-递归" class="headerlink" title="2. 深度优先算法和实现—-递归"></a>2. 深度优先算法和实现—-递归</h5><h6 id="深度优先"><a href="#深度优先" class="headerlink" title="深度优先"></a>深度优先</h6><p>A<br>B C<br>D E  F G H<br>I</p>
<p>爬取顺序<br>A B D E I C F G H （递归实现）</p>
<h6 id="深度优先过程"><a href="#深度优先过程" class="headerlink" title="深度优先过程"></a>深度优先过程</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">depth_tree</span><span class="params">(tree_node)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> tree_node <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">		print(tree_node._data)</span><br><span class="line">		<span class="keyword">if</span> tree_node._left <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">			<span class="keyword">return</span> depth_tree(tree_node._left)</span><br><span class="line">		<span class="keyword">if</span> tree_node._right <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">			<span class="keyword">return</span> depth_tree(tree_node._right)</span><br></pre></td></tr></table></figure>
<p>递归的栈太深会导致溢出</p>
<h5 id="3-广度优先算法和实现—-队列"><a href="#3-广度优先算法和实现—-队列" class="headerlink" title="3. 广度优先算法和实现—-队列"></a>3. 广度优先算法和实现—-队列</h5><h6 id="广度优先"><a href="#广度优先" class="headerlink" title="广度优先"></a>广度优先</h6><p>A<br>B C<br>D E  F G H<br>I</p>
<p>爬取顺序<br>A B C D E F G H I （队列实现）</p>
<h6 id="广度优先过程"><a href="#广度优先过程" class="headerlink" title="广度优先过程"></a>广度优先过程</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">level_queue</span><span class="params">(root)</span>:</span></span><br><span class="line">	<span class="string">"""利用队列实现树的广度优先遍历"""</span></span><br><span class="line">	<span class="keyword">if</span> root <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	my_queue = []</span><br><span class="line">	node = root</span><br><span class="line">	my_queue.append(node)</span><br><span class="line">	<span class="keyword">while</span> my_queue:</span><br><span class="line">		node = my_queue:</span><br><span class="line">		print(node.elem)</span><br><span class="line">		<span class="keyword">if</span> node.lchild <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">			my.queue.append(node.lchild)</span><br><span class="line">		<span class="keyword">if</span> node.rchild <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">			my.queue.append(node.rchild)</span><br></pre></td></tr></table></figure>
<h4 id="爬虫去重策略"><a href="#爬虫去重策略" class="headerlink" title="爬虫去重策略"></a>爬虫去重策略</h4><ol>
<li>将访问过的url保存到数据库中。 <em>(用的非常少，效率低，应用起来最简单的方式)</em></li>
<li>将访问过的url保存到set中，只要o(1)【这是常数阶时间复杂度】的代价就可以查询url 100000000x2bytex50个字符/1024/1024/1024≈9G 一亿条数据，一条50字符。 <em>(当数据量多时，占用内存非常高)</em></li>
<li>url经过md5等方法哈希后保存到set中 <em>(比较常用)</em></li>
<li>用bitmap方法，将访问过的url通过hash函数映射到某一位 <em> (比md5方法更进一步压缩内存，冲突可能性非常大)</em></li>
<li>bloomfilter方法对bitmap进行改进，多重hash函数降级冲突 <em>(减少内存，减少冲突。比url保存set减少的是量级的内存。1亿条大概几十MB的内存)</em></li>
</ol>
<h4 id="字符串编码"><a href="#字符串编码" class="headerlink" title="字符串编码"></a>字符串编码</h4><ol>
<li>计算机只能识别数字，文本转换为数字才能处理。计算机中8个bit作为一个字节，所以一个字节能表示最大的数字就是255.</li>
<li>计算机是美国人发明的，所以一个字节可以表示所有字符了，所以ASCII（一个字节）编码就成为美国人标准编码。</li>
<li>但是ASCII处理中文明显是不够的，中文不止255个汉字，所以中国制定了GB2312编码，用两个字节表示一个汉字。GB2312还把ASCII包含进去了，同理，日文，韩文等等上百个国家为了解决这个问题就都发展了一套字节的编码，标准就越来越多，如果出现多种语言混合就一定会出现乱码。</li>
<li>于是unicode出现了，将所有语言统一到一套编码里。</li>
<li>ASCII和unicode编码：<br>（1）字母A用ASCII编码十进制65，二进制01000001<br>（2）汉字‘中’已超多ASCII编码的范围，用unicode编码是20013，二进制01001110 00101101<br>（3）A用unicode编码中只需要前面补0，二进制是 00000000 01000001</li>
<li>乱码问题解决可，但是如果内容全是英文，unicode编码比ASCII需要多一倍的存储空间，同时如果传输需要多一倍的传输。</li>
<li>所以出现了可变长的编码“utf-8”，把英文变长一个字节，汉字3个字节。特别生僻的变成4-6字节。如果传输大量的英文，utf-8作用就很明显。</li>
</ol>
<p>Unicode编码<br>读取：转换为unicode编码 保存：转换为utf-8编码<br>UTF-8编码 文件：bobby.txt </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python2</span></span><br><span class="line">s = <span class="string">"abc"</span></span><br><span class="line">su = <span class="string">u"abc"</span></span><br><span class="line">s.encode(<span class="string">"utf8"</span>)</span><br><span class="line">su.encode(<span class="string">"utf8"</span>)</span><br><span class="line">s = <span class="string">"我用python"</span></span><br><span class="line">su = <span class="string">u"我用python"</span></span><br><span class="line"><span class="comment">## windows</span></span><br><span class="line">s.decode(<span class="string">"gb2312"</span>).encode(<span class="string">"utf-8"</span>)</span><br><span class="line">su.encode(<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="comment">## linux</span></span><br><span class="line">s.decode(<span class="string">"utf8"</span>).encode(<span class="string">"utf-8"</span>)</span><br><span class="line">su.encode(<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="comment"># 获取系统默认的编码</span></span><br><span class="line">sys.getdefaultencoding()</span><br><span class="line"></span><br><span class="line"><span class="comment">#python3</span></span><br><span class="line">s=<span class="string">"我用python"</span></span><br><span class="line">s.encode(<span class="string">"utf-8"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="第4章-Scrapy爬取知名技术文章网站-1"><a href="#第4章-Scrapy爬取知名技术文章网站-1" class="headerlink" title="第4章 Scrapy爬取知名技术文章网站"></a>第4章 Scrapy爬取知名技术文章网站</h2><p>搭建scrapy的开发环境，本章介绍scrapy的常用命令以及工程目录结构分析，本章中也会详细的讲解xpath和css选择器的使用。然后通过scrapy提供的spider完成所有文章的爬取。然后详细讲解item以及item loader方式完成具体字段的提取后使用scrapy提供的pipeline分别将数据保存到json文件以及mysql数据库中。…</p>
<h3 id="新建开发环境"><a href="#新建开发环境" class="headerlink" title="新建开发环境"></a>新建开发环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv article_spider --python=/Users/jinlong/.pyenv/versions/3.6.3/bin/python</span><br><span class="line">pip install scrapy</span><br><span class="line">cd ~/PycharmProjects</span><br><span class="line">scrapy startproject ArticleSpider</span><br><span class="line">cd ArticleSpider</span><br><span class="line">scrapy genspider jobbole blog.jobbole.com</span><br></pre></td></tr></table></figure>
<h3 id="编写爬虫代码"><a href="#编写爬虫代码" class="headerlink" title="编写爬虫代码"></a>编写爬虫代码</h3><h4 id="调试爬虫的main-py"><a href="#调试爬虫的main-py" class="headerlink" title="调试爬虫的main.py"></a>调试爬虫的main.py</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">from scrapy.cmdline import execute</span><br><span class="line"></span><br><span class="line">sys.path.append(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">execute([&quot;scrapy&quot;, &quot;crawl&quot;, &quot;jobbole&quot;])</span><br></pre></td></tr></table></figure>
<h4 id="settings-py"><a href="#settings-py" class="headerlink" title="settings.py"></a>settings.py</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROBOTSTXT_</span><br></pre></td></tr></table></figure>
<h2 id="第5章-Scrapy爬取知名问答网站-1"><a href="#第5章-Scrapy爬取知名问答网站-1" class="headerlink" title="第5章 Scrapy爬取知名问答网站"></a>第5章 Scrapy爬取知名问答网站</h2><p>本章主要完成网站的问题和回答的提取。本章除了分析出问答网站的网络请求以外还会分别通过requests和scrapy的FormRequest两种方式完成网站的模拟登录， 本章详细的分析了网站的网络请求并分别分析出了网站问题回答的api请求接口并将数据提取出来后保存到mysql中。…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">scrapy startproject crawl_spider</span><br><span class="line">cd crawl_spider</span><br><span class="line"></span><br><span class="line">scrapy genspider jobbole &quot;blog.jobbole.com&quot;</span><br><span class="line">scrapy genspider zhihu &quot;www.zhihu.com&quot;</span><br><span class="line">scrapy genspider lagou &quot;www.lagou.com&quot;</span><br></pre></td></tr></table></figure>
<p>pycharm调试scrapy</p>
<p>main.py 和 scrapy.cfg 在同一级目录下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> scrapy.cmdline <span class="keyword">import</span> execute</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sys.path.append(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">execute([<span class="string">"scrapy"</span>,<span class="string">"crawl"</span>,<span class="string">"jobbole"</span>])</span><br></pre></td></tr></table></figure>
<p>settings.py</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROBOTSTXT_OBEY = <span class="keyword">False</span></span><br></pre></td></tr></table></figure>
<p>伯乐在线提取文章<br>标题，日期，评论，点赞，</p>
<p>xpath</p>
<p>xpath语法<br>/div/<em> 选取属于div元素的所有子节点<br>//</em> 选取所有元素<br>//div[@*] 选取所有带属性的div元素<br>/div/a|//div/p 选取所有div元素的a和p元素<br>//span|//ul 选取文档中的span和ul元素<br>article/div/p|//span 选取所有属于artile的div的p元素和所有的span元素</p>
<p>scrapy shell 调试 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy shell http://blog.jobbole.com/110287/</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">title = response.xpath(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">title = response.xpath(<span class="string">"//div[@class="</span>entry-heade<span class="string">r"]/h1"</span>)</span><br><span class="line"></span><br><span class="line">title = response.xpath(<span class="string">"//div[@class="</span>entry-heade<span class="string">r"]/h1/text()"</span>)</span><br><span class="line"></span><br><span class="line">title = response.xpath(<span class="string">"//div[@class="</span>entry-heade<span class="string">r"]/h1/text()"</span>).extract()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">response.xpath(<span class="string">'//div[@id="archive"]//a[@class="archive-title"]/@href'</span>).extract()</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[element <span class="keyword">for</span> element <span class="keyword">in</span> tag_list <span class="keyword">if</span> <span class="keyword">not</span> element.strip().endswith(<span class="string">"评论"</span>)]</span><br></pre></td></tr></table></figure>
<p>css selector</p>
<p>css选择器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 选择所有节点</span><br><span class="line">#con 选择id为con的节点</span><br><span class="line">.con 选择所有class包含con的节点</span><br><span class="line">li a 选取所有li下的所有a节点</span><br><span class="line">ul + p 选择ul后面的第一个p元素</span><br><span class="line">div#con &gt; ul 选取id为con的div的第一个ul子元素</span><br><span class="line">ul ~ p 选择与ul相邻的所有p元素</span><br><span class="line">a[title] 选取所有有tilte属性的a元素</span><br><span class="line">input[type=radio]:checked 选择选中的radio的元素</span><br><span class="line">div:not(#con) 选取所有id非con的div属性</span><br><span class="line">li:nth-child(3)选取第三个li元素</span><br><span class="line">tr:nth-child(2n)第偶数个tr</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">title = response.css(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">title = response.css(<span class="string">".entry-header h1"</span>)</span><br><span class="line"></span><br><span class="line">title = response.css(<span class="string">".entry-header h1::text"</span>)</span><br><span class="line"></span><br><span class="line">title = response.css(<span class="string">".entry-header h1:text"</span>).extract()</span><br></pre></td></tr></table></figure>
<p>1.获取文章列表页的文章url并交给scrapy下载后并进行解析<br>2.获取下一页的url并交给scrapy进行下载，下载完成后交给parse</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_urls = response.css(<span class="string">".con a::attr(href)"</span>).extract()</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> Request</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载所有文章的url</span></span><br><span class="line"><span class="keyword">yield</span> Request(url=parse.urljoin(response.url, post_url),callback=self.parse_detail)</span><br><span class="line"></span><br><span class="line"><span class="comment">#提取下一页的url</span></span><br><span class="line">next_urls = response.css(<span class="string">".next.page-number::attr(href)"</span>).extract()</span><br><span class="line"><span class="keyword">if</span> next_url:</span><br><span class="line">	<span class="keyword">yield</span> Request(url=parse.urljoin(response.url, post_url),callback=self.parse)</span><br></pre></td></tr></table></figure>
<p>items.py</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobboleItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">	title = scrapy.Field()</span><br></pre></td></tr></table></figure>
<p>scrapy自带的下载中间件<br>图片中间件</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">IMAGES_URLS_FIELD = <span class="string">""</span></span><br><span class="line">IMAGES_STORE = os.path.join(BASE_DIR, <span class="string">'images'</span>)</span><br></pre></td></tr></table></figure>
<p>1.先定义items<br>scrapy items<br>2.在jobbole.py爬虫写处理逻辑<br>yield 爬去的数据<br>3.在pipelines中定义怎么储存yield过来的数据<br>3.1 设置setttings.py中的downloader中间件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DOWNLOADER_MIDDLEWARES = &#123;   &apos;crawl_spider.middlewares.MyCustomDownloaderMiddleware&apos;: 543,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>item loader机制</p>
<h2 id="第6章-通过CrawlSpider对招聘网站进行整站爬取-1"><a href="#第6章-通过CrawlSpider对招聘网站进行整站爬取-1" class="headerlink" title="第6章 通过CrawlSpider对招聘网站进行整站爬取"></a>第6章 通过CrawlSpider对招聘网站进行整站爬取</h2><p>本章完成招聘网站职位的数据表结构设计，并通过link extractor和rule的形式并配置CrawlSpider完成招聘网站所有职位的爬取，本章也会从源码的角度来分析CrawlSpider让大家对CrawlSpider有深入的理解。</p>
<p>Windows下类似linux的终端 ·cmder·</p>
<p>数据库 article_spider</p>
<p>数据表 lagou_job</p>
<p>设计数据表结构</p>
<p><img src="/img/lagou_job.png" alt></p>
<p>编写CrawlSpider</p>
<p>查看scrapy spider提供的模板</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy genspider --list</span><br></pre></td></tr></table></figure>
<p>生成crawlspider</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy genspider -t crawl lagou www.lagou.com</span><br></pre></td></tr></table></figure>
<p>变量PYTHONPATH</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">project_dir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(os.path.dirname(__file__)))</span><br><span class="line">sys.path.insert(<span class="number">0</span>, os.path.join(BASE_DIR, <span class="string">'ArticleSpider'</span>))</span><br></pre></td></tr></table></figure>
<p>CrawlSpider是个什么类？</p>
<p>Rule</p>
<p>LinkExtractor</p>
<h2 id="第7章-Scrapy突破反爬虫的限制-1"><a href="#第7章-Scrapy突破反爬虫的限制-1" class="headerlink" title="第7章 Scrapy突破反爬虫的限制"></a>第7章 Scrapy突破反爬虫的限制</h2><p>本章会从爬虫和反爬虫的斗争过程开始讲解，然后讲解scrapy的原理，然后通过随机切换user-agent和设置scrapy的ip代理的方式完成突破反爬虫的各种限制。本章也会详细介绍httpresponse和httprequest来详细的分析scrapy的功能，最后会通过云打码平台来完成在线验证码识别以及禁用cookie和访问频率来降低爬虫被屏蔽的可能性。…</p>
<h2 id="第8章-Scrapy进阶开发-1"><a href="#第8章-Scrapy进阶开发-1" class="headerlink" title="第8章 Scrapy进阶开发"></a>第8章 Scrapy进阶开发</h2><p>本章将讲解scrapy的更多高级特性，这些高级特性包括通过selenium和phantomjs实现动态网站数据的爬取以及将这二者集成到scrapy中、scrapy信号、自定义中间件、暂停和启动scrapy爬虫、scrapy的核心api、scrapy的telnet、scrapy的web service和scrapy的log配置和email发送等。 这些特性使得我们不仅只是可以通过scrapy来完成…</p>
<h2 id="第9章-Scrapy-redis分布式爬虫-1"><a href="#第9章-Scrapy-redis分布式爬虫-1" class="headerlink" title="第9章 Scrapy-redis分布式爬虫"></a>第9章 Scrapy-redis分布式爬虫</h2><p>Scrapy-redis分布式爬虫的使用以及scrapy-redis的分布式爬虫的源码分析， 让大家可以根据自己的需求来修改源码以满足自己的需求。最后也会讲解如何将bloomfilter集成到scrapy-redis中。</p>
<h2 id="第10章-Elasticsearch搜索引擎的使用-1"><a href="#第10章-Elasticsearch搜索引擎的使用-1" class="headerlink" title="第10章 Elasticsearch搜索引擎的使用"></a>第10章 Elasticsearch搜索引擎的使用</h2><p>本章将讲解elasticsearch的安装和使用，将讲解elasticsearch的基本概念的介绍以及api的使用。本章也会讲解搜索引擎的原理并讲解elasticsearch-dsl的使用，最后讲解如何通过scrapy的pipeline将数据保存到elasticsearch中。</p>
<p><a href="https://www.elastic.co/" target="_blank" rel="noopener">Open Source Search &amp; Analytics · Elasticsearch</a></p>
<p><a href="https://elasticsearch.cn/" target="_blank" rel="noopener">Elastic 中文社区</a></p>
<p><a href="http://lucene.apache.org/solr/" target="_blank" rel="noopener">Apache Solr</a></p>
<p><a href="http://sphinxsearch.com/" target="_blank" rel="noopener">Sphinx | Open Source Search Engine</a></p>
<p><a href="http://lucene.apache.org/" target="_blank" rel="noopener">Apache Lucene - Welcome to Apache Lucene</a></p>
<p><a href="https://www.elastic.co/elk-stack" target="_blank" rel="noopener">ELK Stack: Elasticsearch, Logstash, Kibana | Elastic</a></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h3 id="关系数据搜索缺点"><a href="#关系数据搜索缺点" class="headerlink" title="关系数据搜索缺点"></a><strong>关系数据搜索缺点</strong></h3><ul>
<li>MySQL</li>
</ul>
<ol>
<li>无法打分</li>
<li>无分布式</li>
<li>无法解析搜索请求</li>
<li>效率底（上亿数据量）</li>
<li>分词</li>
</ol>
<h3 id="NoSQL-数据库（Not-only-SQL）"><a href="#NoSQL-数据库（Not-only-SQL）" class="headerlink" title="NoSQL 数据库（Not only SQL）"></a><strong>NoSQL 数据库（Not only SQL）</strong></h3><ul>
<li>MongoDB</li>
<li>Redis</li>
<li>Elasticsearch 主要用途<strong>全文搜索引擎</strong></li>
</ul>
<h1 id="安装-Elasticsearch"><a href="#安装-Elasticsearch" class="headerlink" title="安装 Elasticsearch"></a>安装 Elasticsearch</h1><ol>
<li>安装 elasticsearch-rtf </li>
<li>head 插件和 kibana 安装</li>
</ol>
<p>安装 jdk8 以上，本文使用 jdk8u121。</p>
<p>java version 1.8.0_111</p>
<h2 id="安装-elasticsearch-rtf"><a href="#安装-elasticsearch-rtf" class="headerlink" title="安装 elasticsearch-rtf"></a>安装 elasticsearch-rtf</h2><p><strong>安装 elasticsearch-rtf</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/medcl/elasticsearch-rtf.git -b master --depth 1</span><br></pre></td></tr></table></figure>
<p><strong>配置文件</strong></p>
<p> elasticsearch-rtf/config/elasticsearch.yml</p>
<p> elasticsearch-rtf/data 数据文件</p>
<p> elasticsearch-rtf/lib 库</p>
<p> elasticsearch-rtf/modules 模块</p>
<p> elasticsearch-rtf/plugins 插件</p>
<p><strong>运行</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">elasticsearch-rtf/bin/elasticsearch</span><br></pre></td></tr></table></figure>
<p><a href="https://hub.docker.com/r/libac/elasticsearch-rtf" target="_blank" rel="noopener">libac/elasticsearch-rtf - Docker Hub</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name elasticsearch-rtf -p 9200:9200 -p 9300:9300 libac/elasticsearch-rtf</span><br></pre></td></tr></table></figure>
<p><strong>访问</strong></p>
<p><a href="http://localhost:9200" target="_blank" rel="noopener">http://localhost:9200</a></p>
<h2 id="安装-head-插件和-kibana"><a href="#安装-head-插件和-kibana" class="headerlink" title="安装 head 插件和 kibana"></a>安装 head 插件和 kibana</h2><ul>
<li>head 插件：基于浏览器的插件可以完成类似于 Navicat 的功能</li>
<li>使用的是 kibana 项目中的一个 sense。</li>
</ul>
<h3 id="elasticsearch-head"><a href="#elasticsearch-head" class="headerlink" title="elasticsearch-head"></a>elasticsearch-head</h3><p><a href="https://github.com/mobz/elasticsearch-head" target="_blank" rel="noopener">mobz/elasticsearch-head: A web front end for an elastic search cluster</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/mobz/elasticsearch-head.git</span><br><span class="line">cd elasticsearch-head</span><br><span class="line">npm install</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure>
<p><a href="https://hub.docker.com/r/mobz/elasticsearch-head/" target="_blank" rel="noopener">mobz/elasticsearch-head - Docker Hub</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name elasticsearch-head-5 -p 9100:9100 mobz/elasticsearch-head:5</span><br></pre></td></tr></table></figure>
<p><strong>访问</strong></p>
<p><a href="http://localhost:9100/" target="_blank" rel="noopener">http://localhost:9100/</a></p>
<p><strong>head 访问 elasticsearch 设置</strong></p>
<p> elasticsearch.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"><span class="string">http.cors.allow-methods:</span> <span class="string">OPTIONS,</span> <span class="string">HEAD,</span> <span class="string">GET,</span> <span class="string">PUT,</span> <span class="string">DELETE</span></span><br><span class="line"><span class="string">http.cors.allow-headers:</span> <span class="string">"X-Requested-With, Content-Type, Content-Length, X-User"</span></span><br></pre></td></tr></table></figure>
<h3 id="kibana-sense"><a href="#kibana-sense" class="headerlink" title="kibana sense"></a>kibana sense</h3><p>kibana 版本需要和 elasticsearch 版本一致。</p>
<p><a href="https://www.elastic.co/downloads/past-releases/kibana-5-1-1" target="_blank" rel="noopener">Kibana 5.1.1 | Elastic</a></p>
<p>讲课用的是 windows 版本 kibana 5.1.2</p>
<p><a href="https://www.elastic.co/guide/en/kibana/current/docker.html" target="_blank" rel="noopener">Running Kibana on Docker</a></p>
<p><a href="https://hub.docker.com/_/kibana" target="_blank" rel="noopener">kibana - Docker Hub</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kibana:5.1.1</span><br></pre></td></tr></table></figure>
<p><strong>运行</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name kibana-5.1.1 -p 5601:5601 -e ELASTICSEARCH_URL=http://172.19.241.212:9200 kibana:5.1.1</span><br><span class="line"></span><br><span class="line">docker stop kibana-5.1.1</span><br><span class="line">docker rm kibana-5.1.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器 ip 地址</span></span><br><span class="line">docker inspect --format '&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;' kibana-5.1.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> elasticsearch.yml</span></span><br><span class="line">network.host: 0.0.0.0</span><br></pre></td></tr></table></figure>
<p><strong>访问</strong></p>
<p><a href="http://localhost:5601" target="_blank" rel="noopener">http://localhost:5601</a></p>
<p><a href="http://localhost:5601/app/kibana#/dev_tools/console?_g=(" target="_blank" rel="noopener">Console - Kibana</a>)</p>
<p>Sense 改名为 Dev Tools。</p>
<h1 id="elasticsearch-概念"><a href="#elasticsearch-概念" class="headerlink" title="elasticsearch 概念"></a>elasticsearch 概念</h1><ol>
<li><strong>集群</strong>：一个或者多个节点组织在一起。</li>
<li><strong>节点</strong>：一个节点是集群中的一个服务器，由一个名字来标识，默认是一个随机的漫画角色的名字</li>
<li><strong>分片</strong>：将索引划分为多份的能力，允许水平分割和扩展容量，多个分片响应请求，提高性能和吞吐量</li>
<li><strong>副本</strong>：创建分片的一份或多份的能力，在一个节点失败其余节点可以顶上</li>
</ol>
<p><strong>mysql 和 elasticsearch 概念对比</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">elasticsearch</th>
<th>mysql</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">index(索引)</td>
<td>数据库</td>
</tr>
<tr>
<td style="text-align:left">type(类型)</td>
<td>表</td>
</tr>
<tr>
<td style="text-align:left">documents(文档)</td>
<td>行</td>
</tr>
<tr>
<td style="text-align:left">fields</td>
<td>列</td>
</tr>
</tbody>
</table>
<h1 id="HTTP方法"><a href="#HTTP方法" class="headerlink" title="HTTP方法"></a>HTTP方法</h1><ul>
<li>HTTP1.0 定义三种请求方式：GET, POST 和 HEAD 方法</li>
<li>HTTP1.1 新增了五种方法：OPTIONS, PUT, DELETE, TRACE, CONNECT</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">GET</td>
<td>请求指定的页面信息，并返回实体主体</td>
</tr>
<tr>
<td style="text-align:left">POST</td>
<td>向服务器提交数据进行处理。</td>
</tr>
<tr>
<td style="text-align:left">PUT</td>
<td>向服务器传送的数据取代指定的文档的内容。</td>
</tr>
<tr>
<td style="text-align:left">DELETE</td>
<td>请求服务器删除指定的页面。</td>
</tr>
</tbody>
</table>
<h1 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h1><p>由属性值来确定记录的位置。</p>
<p><strong>Python 写各大聊天系统的屏蔽脏话功能原理</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">关键词</th>
<th>文章</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">python</td>
<td>文章1，文章3</td>
</tr>
<tr>
<td style="text-align:left">聊天</td>
<td>文章2</td>
</tr>
<tr>
<td style="text-align:left">系统</td>
<td>文章3，文章4</td>
</tr>
<tr>
<td style="text-align:left">屏蔽脏话</td>
<td>文章5</td>
</tr>
</tbody>
</table>
<p>文章中<strong>关键词</strong>频率高，权重就高。</p>
<table>
<thead>
<tr>
<th style="text-align:left">关键词</th>
<th>倒排列表</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">python</td>
<td>（文章1，&lt;2，10&gt;，2）</td>
</tr>
<tr>
<td style="text-align:left">聊天</td>
<td>（文章2，&lt;12，25，100&gt;，3）</td>
</tr>
<tr>
<td style="text-align:left">系统</td>
<td>（文章3，\<10>，1）</10></td>
</tr>
<tr>
<td style="text-align:left">屏蔽脏话</td>
<td>（文章5，&lt;50，60&gt;，2）</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>TF-IDF</strong>：elasticsearch 打分</p>
</blockquote>
<h2 id="倒排索引待解决的问题"><a href="#倒排索引待解决的问题" class="headerlink" title="倒排索引待解决的问题"></a>倒排索引待解决的问题</h2><ol>
<li>大小写转换问题，如 python 和 PYTHON 应该为一个词</li>
<li>词干抽取，looking 和 look 应该处理为一个词</li>
<li>分词，如<strong>屏蔽系统</strong>应该分词为”屏蔽“、”系统“还是应该分为”屏蔽系统“</li>
<li>倒排索引文件过大 - 压缩编码</li>
</ol>
<h1 id="elasticsearch-的文档和索引的-CRUD-操作"><a href="#elasticsearch-的文档和索引的-CRUD-操作" class="headerlink" title="elasticsearch 的文档和索引的 CRUD 操作"></a>elasticsearch 的文档和索引的 CRUD 操作</h1><blockquote>
<p>CRUD：增删改查</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># es 的文档、索引的 CRUD 操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 索引初始化操作</span></span><br><span class="line"><span class="comment"># 指定分片和副本的数量</span></span><br><span class="line"><span class="comment"># shards 一旦设置不能修改</span></span><br><span class="line"></span><br><span class="line"><span class="string">PUT</span> <span class="string">lagou</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "settings":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "index":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "number_of_shards":</span><span class="number">5</span><span class="string">,</span></span><br><span class="line"><span class="attr">      "number_of_replicas":</span><span class="number">1</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>elasticsearch-head 索引中可以新建和删除 index。</p>
<p>获取信息</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 _settings 信息</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_settings</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_all/_settings</span></span><br><span class="line"><span class="string">GET</span> <span class="string">.kibana,lagou/_settings</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_settings</span></span><br></pre></td></tr></table></figure>
<p>修改信息</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 _settings 信息</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">lagou/_settings</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "number_of_replicas":</span> <span class="number">3</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>获取索引信息</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取索引信息</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_all</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou</span></span><br></pre></td></tr></table></figure>
<p>保存文档</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存文档</span></span><br><span class="line"><span class="comment"># lagou 是 index</span></span><br><span class="line"><span class="comment"># job 是 type</span></span><br><span class="line"><span class="comment"># 1 是文档 id _id</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">lagou/job/1</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "title":</span><span class="string">"python分布式爬虫开发"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "salary_min":</span><span class="number">15000</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "city":</span><span class="string">"北京"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "company":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "name":</span><span class="string">"百度"</span><span class="string">,</span></span><br><span class="line"><span class="attr">    "company_addr":</span><span class="string">"北京市软件园"</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "publish_date":</span><span class="string">"2017-4-16"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "comments":</span><span class="number">15</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动生成 _id</span></span><br><span class="line"><span class="string">POST</span> <span class="string">lagou/job/</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "title":</span><span class="string">"python django 开发工程师"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "salary_min":</span><span class="number">30000</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "city":</span><span class="string">"上海"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "company":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "name":</span><span class="string">"美团科技"</span><span class="string">,</span></span><br><span class="line"><span class="attr">    "company_addr":</span><span class="string">"北京市软件园A区"</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "publish_date":</span><span class="string">"2017-4-16"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "comments":</span><span class="number">20</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>获取文档</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/job/1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/job/1?_source=title</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/job/1?_source=title,city</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/job/1?_source</span></span><br></pre></td></tr></table></figure>
<p>修改文档</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 覆盖修改</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">lagou/job/1</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "title":</span><span class="string">"python分布式爬虫开发"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "salary_min":</span><span class="number">15000</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "company":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "name":</span><span class="string">"百度"</span><span class="string">,</span></span><br><span class="line"><span class="attr">    "company_addr":</span><span class="string">"北京市软件园"</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "publish_date":</span><span class="string">"2017-4-16"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "comments":</span><span class="number">15</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增量修改，修改某一个字段</span></span><br><span class="line"><span class="string">POST</span> <span class="string">lagou/job/1/_update</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "doc":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "comments":</span><span class="number">20</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>删除</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除文档</span></span><br><span class="line"><span class="string">DELETE</span> <span class="string">lagou/job/1</span></span><br><span class="line"><span class="comment"># 删除索引 index</span></span><br><span class="line"><span class="string">DELETE</span> <span class="string">lagou</span></span><br></pre></td></tr></table></figure>
<h1 id="elasticsearch-批量操作"><a href="#elasticsearch-批量操作" class="headerlink" title="elasticsearch 批量操作"></a>elasticsearch 批量操作</h1><blockquote>
<p>mget 批量获取和 bulk 批量操作</p>
</blockquote>
<h2 id="mget"><a href="#mget" class="headerlink" title="mget"></a>mget</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mget 一次查询多条记录</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_mget</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "doc":</span><span class="string">[</span></span><br><span class="line">    <span class="string">&#123;"_index":"testdb1",</span></span><br><span class="line"><span class="attr">      "_type":</span><span class="string">"job1"</span><span class="string">,</span></span><br><span class="line"><span class="attr">      "_id":</span><span class="number">1</span></span><br><span class="line">    <span class="string">&#125;,</span></span><br><span class="line">    <span class="string">&#123;"_index":"testdb2",</span></span><br><span class="line"><span class="attr">      "_type":</span><span class="string">"job2"</span><span class="string">,</span></span><br><span class="line"><span class="attr">      "_id":</span><span class="number">2</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同一个 index 下 mget</span></span><br><span class="line"><span class="string">GET</span> <span class="string">testdb/_mget</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "doc":</span><span class="string">[</span></span><br><span class="line">    <span class="string">&#123;"_type":"job1",</span></span><br><span class="line"><span class="attr">      "_id":</span><span class="number">1</span></span><br><span class="line">    <span class="string">&#125;,</span></span><br><span class="line">    <span class="string">&#123;_type":"job2",</span></span><br><span class="line"><span class="attr">      "_id":</span><span class="number">2</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同一个 type 下 mget</span></span><br><span class="line"><span class="string">GET</span> <span class="string">testdb/job1/_mget</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "doc":</span><span class="string">[</span></span><br><span class="line">    <span class="string">&#123;"_id":1</span></span><br><span class="line">    <span class="string">&#125;,</span></span><br><span class="line">    <span class="string">&#123;"_id":2</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    <span class="string">]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同一个 type 下 mget，简写方式</span></span><br><span class="line"><span class="string">GET</span> <span class="string">testdb/job1/_mget</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "ids":</span><span class="string">[1,2]</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="bulk-批量操作"><a href="#bulk-批量操作" class="headerlink" title="bulk 批量操作"></a>bulk 批量操作</h2><p>批量导入可以合并多个操作，比如 index，delete，update，create 等等。也可以帮助从一个索引导入到另一个索引。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123;<span class="attr">"index"</span>:&#123;<span class="attr">"_index"</span>:<span class="string">"lagou"</span>,<span class="attr">"_type"</span>:<span class="string">"job1"</span>,<span class="attr">"_id"</span>:<span class="string">"1"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"title"</span>:<span class="string">"python分布式爬虫开发"</span>,<span class="attr">"salary_min"</span>:<span class="number">15000</span>,<span class="attr">"city"</span>:<span class="string">"北京"</span>,<span class="attr">"company"</span>:&#123;<span class="attr">"name"</span>:<span class="string">"百度"</span>,<span class="attr">"company_addr"</span>:<span class="string">"北京市软件园"</span>&#125;,<span class="attr">"publish_date"</span>:<span class="string">"2017-4-16"</span>,<span class="attr">"comments"</span>:<span class="number">15</span>&#125;</span><br><span class="line">&#123;<span class="attr">"index"</span>:&#123;<span class="attr">"_index"</span>:<span class="string">"lagou"</span>,<span class="attr">"_type"</span>:<span class="string">"job2"</span>,<span class="attr">"_id"</span>:<span class="string">"2"</span>&#125;&#125;</span><br><span class="line">&#123;<span class="attr">"title"</span>:<span class="string">"python django开发"</span>,<span class="attr">"salary_min"</span>:<span class="number">30000</span>,<span class="attr">"city"</span>:<span class="string">"成都"</span>,<span class="attr">"company"</span>:&#123;<span class="attr">"name"</span>:<span class="string">"阿里巴巴"</span>,<span class="attr">"company_addr"</span>:<span class="string">"北京市软件园B区"</span>&#125;,<span class="attr">"publish_date"</span>:<span class="string">"2017-4-18"</span>,<span class="attr">"comments"</span>:<span class="number">50</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">"index"</span> : &#123; <span class="attr">"_index"</span> : <span class="string">"test"</span>, <span class="attr">"_type"</span> : <span class="string">"type1"</span>, <span class="attr">"_id"</span> : <span class="string">"1"</span> &#125; &#125;</span><br><span class="line">&#123; <span class="attr">"field1"</span> : <span class="string">"value1"</span> &#125;</span><br><span class="line"></span><br><span class="line">&#123; <span class="attr">"delete"</span> : &#123; <span class="attr">"_index"</span> : <span class="string">"test"</span>, <span class="attr">"_type"</span> : <span class="string">"type1"</span>, <span class="attr">"_id"</span> : <span class="string">"2"</span> &#125; &#125;</span><br><span class="line"></span><br><span class="line">&#123; <span class="attr">"create"</span> : &#123; <span class="attr">"_index"</span> : <span class="string">"test"</span>, <span class="attr">"_type"</span> : <span class="string">"type1"</span>, <span class="attr">"_id"</span> : <span class="string">"3"</span> &#125; &#125;</span><br><span class="line">&#123; <span class="attr">"field1"</span> : <span class="string">"value3"</span> &#125;</span><br><span class="line"></span><br><span class="line">&#123; <span class="attr">"update"</span> : &#123;<span class="attr">"_id"</span> : <span class="string">"1"</span>, <span class="attr">"_type"</span> : <span class="string">"type1"</span>, <span class="attr">"_index"</span> : <span class="string">"index1"</span>&#125; &#125;</span><br><span class="line">&#123; "doc" &#123;"field2" : "value2"&#125; &#125;</span><br></pre></td></tr></table></figure>
<p>bulk 发送数据到一个节点去解析，然后分发给其他节点分片进行操作。</p>
<h1 id="elasticsearch-的-mapping-映射管理"><a href="#elasticsearch-的-mapping-映射管理" class="headerlink" title="elasticsearch 的 mapping 映射管理"></a>elasticsearch 的 mapping 映射管理</h1><p>映射(mapping) <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-store.html" target="_blank" rel="noopener">mapping-store | Elasticsearch Reference [6.5] | Elastic</a></p>
<p><strong>映射</strong>：创建索引的时候，可以预先定义字段的类型以及相关属性</p>
<blockquote>
<p>每个字段是什么类型的以及有什么属性。</p>
</blockquote>
<p>elasticsearch 会根据 JSON 源数据的基础类型猜测你想要的字段映射，将输入的数据转变成可搜索的索引项。Mapping 就是我们自己定义字段的数据类型，同时告诉 elasticsearch 如何索引数据以及是否可以被搜索。</p>
<p><strong>作用</strong>：会让索引建立的更加细致和完善</p>
<p><strong>类型</strong>：<strong>静态映射</strong>和<strong>动态映射</strong></p>
<h2 id="内置类型"><a href="#内置类型" class="headerlink" title="内置类型"></a>内置类型</h2><ul>
<li>string 类型：text，keyword（string 类型在 es5 开始已经废弃）</li>
<li>数字类型：long，integer，short，byte，double，float</li>
<li>日期类型：date（datetime 也可以解析）</li>
<li>bool 类型：boolean</li>
<li>binary 类型：binary（二进制数据类型不会被检索）</li>
<li>复杂类型：object，nested</li>
<li>geo 类型：geo-point，geo-shape</li>
<li>专业类型：ip，competion</li>
</ul>
<p>object 类型：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"company":&#123;"name":"百度","company_addr":"北京市软件园"&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>company 就是 object 类型。</p>
</blockquote>
<p>nested 类型：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">"company":&#123;</span><br><span class="line">    "name":"百度",</span><br><span class="line">    "company_addr":"北京市软件园",</span><br><span class="line">    "emplyee":[&#123;</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"百度"</span>,</span><br><span class="line">    <span class="attr">"age"</span>:<span class="number">28</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"百度"</span>,</span><br><span class="line">    <span class="attr">"age"</span>:<span class="number">28</span></span><br><span class="line">    &#125;&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>object 类型放到数组里面，就是 nested 类型。</p>
<p>emplyee 就是 nested 类型。</p>
</blockquote>
<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th>描述</th>
<th>适合类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">store</td>
<td>值为 yes 表示存储，为 no 表示不存储，默认为 no</td>
<td>all</td>
</tr>
<tr>
<td style="text-align:left">index</td>
<td>yes 表示分析，no 表示不分析，默认为 true</td>
<td>string</td>
</tr>
<tr>
<td style="text-align:left">null_value</td>
<td>如果字段为空，可以设置一个默认值，比如“NA”</td>
<td>all</td>
</tr>
<tr>
<td style="text-align:left">analyzer</td>
<td>可以设置索引和搜索使用的分析器，默认使用的是 standard 分析器，还可以使用 whitespace、simple、english</td>
<td>all</td>
</tr>
<tr>
<td style="text-align:left">include_in_all</td>
<td>默认 es 为每个文档定义一个特殊域 _all，它的作用是让每个字段被搜索到，如果不想某个字段被搜索到，可以设置为 false</td>
<td>all</td>
</tr>
<tr>
<td style="text-align:left">format</td>
<td>时间格式字符串的模式</td>
<td>date</td>
</tr>
</tbody>
</table>
<h2 id="mapping"><a href="#mapping" class="headerlink" title="mapping"></a>mapping</h2><p>新建 mapping</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建 mapping</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">lagou</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "mappings":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "job":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "properties":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "title":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"text"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "salary_min":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"integer"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "city":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"keyword"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "company":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "properties":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">            "name":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">              "type":</span><span class="string">"text"</span></span><br><span class="line">            <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">            "company_addr":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">              "type":</span><span class="string">"text"</span></span><br><span class="line">            <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">            "employee_count":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">              "type":</span><span class="string">"integer"</span></span><br><span class="line">            <span class="string">&#125;</span></span><br><span class="line">          <span class="string">&#125;</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "publish_date":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"date"</span><span class="string">,</span></span><br><span class="line"><span class="attr">          "format":</span> <span class="string">"yyyy-mm-dd"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "comments":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"integer"</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>获取 mapping 信息</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">lagou/_mapping/job</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_all/_mapping/job</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>mapping 一旦创建了类型就不能修改。</p>
</blockquote>
<h1 id="elasticsearch-查询"><a href="#elasticsearch-查询" class="headerlink" title="elasticsearch 查询"></a>elasticsearch 查询</h1><p>elasticsearch 是功能非常强大的搜索引擎，使用它的目的是为了快速的查询到需要的数据。</p>
<h2 id="查询分类"><a href="#查询分类" class="headerlink" title="查询分类"></a>查询分类</h2><ul>
<li>基本查询：使用 elasticsearch 内置查询条件进行查询</li>
<li>组合查询：把多个查询组合在一起进行复合查询</li>
<li>过滤：查询同时，通过 filter 条件在不影响打分的情况下筛选数据</li>
</ul>
<h2 id="基本查询"><a href="#基本查询" class="headerlink" title="基本查询"></a>基本查询</h2><p><strong>测试数据准备</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mapping</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">lagou</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "mappings":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "job":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "properties":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "title":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "store":</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"text"</span><span class="string">,</span></span><br><span class="line"><span class="attr">          "analyzer":</span> <span class="string">"ik_max_word"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "company_name":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "store":</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"keyword"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "desc":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"text"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "comments":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"integer"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "add_time":</span><span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"date"</span><span class="string">,</span></span><br><span class="line"><span class="attr">          "format":</span> <span class="string">"yyyy-mm-dd"</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="string">DELETE</span> <span class="string">lagou</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加数据 1</span></span><br><span class="line"><span class="string">POST</span> <span class="string">lagou/job/</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "title":</span><span class="string">"python django 开发工程师"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "company_name":</span><span class="string">"美团科技有限公司"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "desc":</span><span class="string">"对django的概念熟悉，熟悉python基础知识"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "comments":</span><span class="number">20</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "add_time":</span><span class="string">"2017-4-1"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加数据 2</span></span><br><span class="line"><span class="string">POST</span> <span class="string">lagou/job/</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "title":</span><span class="string">"python scrapy redis分布式爬虫基本"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "company_name":</span><span class="string">"百度科技有限公司"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "desc":</span><span class="string">"对scrapy的概念熟悉，熟悉redis的基本操作"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "comments":</span><span class="number">5</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "add_time":</span><span class="string">"2017-4-15"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加数据 3</span></span><br><span class="line"><span class="string">POST</span> <span class="string">lagou/job/</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "title":</span><span class="string">"elasticsearch打造搜索引擎"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "company_name":</span><span class="string">"阿里巴巴科技有限公司"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "desc":</span><span class="string">"熟悉数据结构算法，熟悉python的基本开发"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "comments":</span><span class="number">15</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "add_time":</span><span class="string">"2017-6-20"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加数据 4</span></span><br><span class="line"><span class="string">POST</span> <span class="string">lagou/job/</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "title":</span><span class="string">"python打造推荐引擎系统"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "company_name":</span><span class="string">"阿里巴巴科技有限公司"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "desc":</span><span class="string">"熟悉推荐引擎的原理以及算法，掌握C语言"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "comments":</span><span class="number">60</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "add_time":</span><span class="string">"2016-10-20"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>match 查询</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询 python 关键词</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/job/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "match":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "title":</span> <span class="string">"python"</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>term 查询</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># term 查询，只能查询到”阿里巴巴科技有限公司“</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "term":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "company_name":</span> <span class="string">"阿里巴巴科技有限公司"</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>term 查询，不会对查询的词做处理</p>
</blockquote>
<p>terms 查询</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># terms 查询，查到"工程师", "django", "系统"任意一个。</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "terms":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "title":</span> <span class="string">["工程师",</span> <span class="string">"django"</span><span class="string">,</span> <span class="string">"系统"</span><span class="string">]</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>控制查询的返回数量</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from 从哪个开始，size 返回的条数</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "match":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "title":</span> <span class="string">"python"</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "from":</span> <span class="number">0</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "size":</span> <span class="number">3</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>match_all 查询</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "match_all":</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>返回所有数据</p>
</blockquote>
<p>match_phrase 查询（短语查询 ）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># match_phrase 必须满足”python系统”这个词</span></span><br><span class="line"><span class="comment"># slop 词之间的距离，“python“和”系统”之间可以有6个词的距离。例如匹配："python打造推荐引擎系统"</span></span><br><span class="line"><span class="string">GET</span> <span class="string">/lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "match_phrase":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "title":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "query":</span> <span class="string">"python系统"</span><span class="string">,</span></span><br><span class="line"><span class="attr">        "slop":</span> <span class="number">6</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>multi_match 查询</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># title^3， titile 的权重是 desc 的 3倍。</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "multi_match":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "query":</span> <span class="string">"python"</span><span class="string">,</span></span><br><span class="line"><span class="attr">      "fields":</span> <span class="string">["title^3",</span> <span class="string">"desc"</span><span class="string">]</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以指定多个字段，比如查询 title 和 desc 这两个字段里面包含 python 的关键词文档</p>
</blockquote>
<p>指定返回字段</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># stored_fields，mapping 设置中 store 为 ture 的字段返回</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "stored_fields":</span> <span class="string">["title","company_name"],</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "match":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "title":</span> <span class="string">"python"</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>通过 sort 把结果排序</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># comments 字段，desc 降序排序</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "match_all":</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "sort":</span> <span class="string">[</span></span><br><span class="line">    <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "comments":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "order":</span> <span class="string">"desc"</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">]</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>查询范围</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># comments 字段</span></span><br><span class="line"><span class="comment"># gte 大于等于，lte 小于等于，boost 权重</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "range":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "comments":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "gte":</span> <span class="number">10</span><span class="string">,</span></span><br><span class="line"><span class="attr">        "lte":</span> <span class="number">20</span><span class="string">,</span></span><br><span class="line"><span class="attr">        "boost":</span> <span class="number">2.0</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>时间范围查询</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "range":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "add_time":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "gte":</span> <span class="string">"2017-04-01"</span><span class="string">,</span></span><br><span class="line"><span class="attr">        "lte":</span> <span class="string">"now"</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>wildcard 查询（简单的模糊查询）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pyth*n，模糊匹配</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "wildcard":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "title":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "value":</span> <span class="string">"pyth*n"</span><span class="string">,</span></span><br><span class="line"><span class="attr">        "boost":</span> <span class="number">2.0</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h2><p><strong>建立测试数据</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">lagou/testjob/_bulk</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":1&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"salary":10,</span> <span class="string">"title"</span><span class="string">:"Python"&#125;</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":2&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"salary":20,</span> <span class="string">"title"</span><span class="string">:"Scrapy"&#125;</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":3&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"salary":30,</span> <span class="string">"title"</span><span class="string">:"Elasticsearch"&#125;</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":4&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"salary":40,</span> <span class="string">"title"</span><span class="string">:"Elasticsearch"&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="bool-查询"><a href="#bool-查询" class="headerlink" title="bool 查询"></a>bool 查询</h3><blockquote>
<p>老版本的 filtered 已经被 bool 替换</p>
<p>用 bool 包括 must should must_not  filter 来完成</p>
</blockquote>
<ul>
<li>filter：字段过滤，不参与打分的</li>
<li>must： 所有查询都必须同时满足</li>
<li>should：查询条件满足一个或多个</li>
<li>must_not：查询条件一个都不用满足</li>
</ul>
<p>简单过滤查询</p>
<blockquote>
<p>SQL 语句：<code>select * from testjob where salary=20</code></p>
<p>薪资为20k的工作</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单过滤查询</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/testjob/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "bool":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "must":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "match_all":</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="string">&#125;,</span> </span><br><span class="line"><span class="attr">      "filter":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "term":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "salary":</span> <span class="number">20</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># must 可以省略</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/testjob/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "bool":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "filter":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "term":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "salary":</span> <span class="number">20</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>查询多个指定值</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">lagou/testjob/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "bool":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "filter":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "terms":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "salary":</span><span class="string">[10,20]</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>查询指定值</p>
<blockquote>
<p>SQL 语句：<code>select * from testjob where title=&quot;Python&quot;</code></p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">lagou/testjob/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "bool":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "filter":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "terms":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "title":</span> <span class="string">"python"</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>查看 ik 分析器解析的结果</strong></p>
<p>分词器 ik <a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener">medcl/elasticsearch-analysis-ik: The IK Analysis plugin integrates Lucene IK analyzer into elasticsearch, support customized dictionary.</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认分词器</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_analyze</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "text":</span> <span class="string">"Python网络开发工程师"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ik_max_word</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_analyze</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "analyzer":</span> <span class="string">"ik_max_word"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "text":</span> <span class="string">"Python网络开发工程师"</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ik_smart，最小的数据集合分割词组</span></span><br><span class="line"><span class="string">GET</span> <span class="string">_analyze</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "analyzer":</span> <span class="string">"ik_smart"</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "text":</span> <span class="string">"Python网络开发工程师"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>bool 过滤查询，可以做组合过滤查询</p>
<blockquote>
<p>SQL 语句：<code>select * from testjob where (salary=20 OR title=Python) AND (salary != 30)</code></p>
<p>查询薪资等于20k或者工作为 python 的工作，排除价格为30k的</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">lagou/testjob/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "bool":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "should":</span> <span class="string">[</span></span><br><span class="line">        <span class="string">&#123;"term":</span> <span class="string">&#123;"salary":</span> <span class="number">20</span><span class="string">&#125;&#125;,</span></span><br><span class="line">        <span class="string">&#123;"term":</span> <span class="string">&#123;"title":</span> <span class="string">"python"</span><span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="string">],</span></span><br><span class="line"><span class="attr">      "must_not":</span> <span class="string">[</span></span><br><span class="line">        <span class="string">&#123;"term":</span> <span class="string">&#123;"salary":</span> <span class="number">30</span><span class="string">&#125;&#125;,</span></span><br><span class="line">        <span class="string">&#123;"term":</span> <span class="string">&#123;"salary":</span> <span class="number">10</span><span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="string">]</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>嵌套查询</p>
<blockquote>
<p>SQL 语句：<code>select * from testjob where title=&quot;python&quot; or (title=&quot;elasticsearch&quot; AND salary=30)</code></p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">lagou/testjob/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "bool":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "should":</span> <span class="string">[</span></span><br><span class="line">        <span class="string">&#123;"term":&#123;"title":"python"&#125;&#125;,</span></span><br><span class="line">        <span class="string">&#123;"bool":&#123;</span></span><br><span class="line"><span class="attr">          "must":</span> <span class="string">[</span></span><br><span class="line">            <span class="string">&#123;"term":&#123;"title":"elasticsearch"&#125;&#125;,</span></span><br><span class="line">            <span class="string">&#123;"term":&#123;"salary":30&#125;&#125;</span></span><br><span class="line">          <span class="string">]</span></span><br><span class="line">         <span class="string">&#125;</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">]</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="过滤空和非空数据"><a href="#过滤空和非空数据" class="headerlink" title="过滤空和非空数据"></a>过滤空和非空数据</h3><p><strong>测试数据准备</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">lagou/testjob2/_bulk</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":1&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"tags":["search"]&#125;</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":2&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"tags":["search",</span> <span class="string">"python"</span><span class="string">]&#125;</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":3&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"other_field":["some</span> <span class="string">data"]&#125;</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":4&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"tags":null&#125;</span></span><br><span class="line"><span class="string">&#123;"index":&#123;"_id":5&#125;&#125;</span></span><br><span class="line"><span class="string">&#123;"tags":["search",</span> <span class="literal">null</span><span class="string">]&#125;</span></span><br></pre></td></tr></table></figure>
<p>处理 null 空值的方法</p>
<blockquote>
<p>SQL 语句：<code>select tags from testjob2 where tags is not NULL</code></p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tags 值不为空，参数存在的</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/testjob2/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "bool":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "filter":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "exists":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "field":</span> <span class="string">"tags"</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tags 值为空，参数不存在的</span></span><br><span class="line"><span class="string">GET</span> <span class="string">lagou/testjob2/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "bool":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "must_not":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "exists":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "field":</span> <span class="string">"tags"</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="搜索建议接口"><a href="#搜索建议接口" class="headerlink" title="搜索建议接口"></a>搜索建议接口</h1><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-suggesters-completion.html" target="_blank" rel="noopener">Completion Suggester | Elasticsearch Reference [6.5] | Elastic</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PUT</span> <span class="string">music</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "mappings":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "song":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "properties":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "suggest":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"completion"</span></span><br><span class="line">        <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">        "title":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "type":</span> <span class="string">"keyword"</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="Fuzzy-Query（模糊搜索）"><a href="#Fuzzy-Query（模糊搜索）" class="headerlink" title="Fuzzy Query（模糊搜索）"></a>Fuzzy Query（模糊搜索）</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">jobbole/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "fuzzy":</span> <span class="string">&#123;"title"</span> <span class="string">:</span> <span class="string">"linx"</span><span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "_source":</span><span class="string">["title"]</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>编辑距离：编辑距离是一种字符串之间相似程度的计算方式。</p>
<p>例如： linux 和 linx，添加 u，两个字符串相同，遍历距离为1。</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fuzziness 编辑距离</span></span><br><span class="line"><span class="comment"># prefix_length 不能编辑的距离，lin 不能动，然后 un 和 x 对比编辑距离。</span></span><br><span class="line"><span class="string">GET</span> <span class="string">/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "fuzzy":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "title":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "value":</span> <span class="string">"linux"</span><span class="string">,</span></span><br><span class="line"><span class="attr">        "fuzziness":</span> <span class="number">2</span><span class="string">,</span></span><br><span class="line"><span class="attr">        "prefix_length":</span> <span class="number">0</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "_source":</span> <span class="string">"title"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">jobbole/_search?pretty</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "suggest":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "my-suggest":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "text":</span> <span class="string">"linux"</span><span class="string">,</span></span><br><span class="line"><span class="attr">      "completion":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "field":</span> <span class="string">"suggest"</span><span class="string">,</span></span><br><span class="line"><span class="attr">        "fuzzy":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">          "fuzziness":</span> <span class="number">2</span></span><br><span class="line">        <span class="string">&#125;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "_source":</span> <span class="string">"title"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Highlighting-关键字高亮显示"><a href="#Highlighting-关键字高亮显示" class="headerlink" title="Highlighting 关键字高亮显示"></a>Highlighting 关键字高亮显示</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">"highlight":</span> <span class="string">&#123;</span></span><br><span class="line">	<span class="string">"pre_tags"</span><span class="string">:</span> <span class="string">['&lt;span</span> <span class="string">class="keyWord"&gt;'],</span></span><br><span class="line">	<span class="string">"post_tags"</span><span class="string">:</span> <span class="string">['&lt;/span&gt;'],</span></span><br><span class="line"><span class="attr">    "fields":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">        "title":</span> <span class="string">&#123;&#125;,</span></span><br><span class="line"><span class="attr">        "content":</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">jobbole/_search</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="attr">  "query":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "multi_match":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "query":</span> <span class="string">"linux"</span><span class="string">,</span></span><br><span class="line"><span class="attr">      "fields":</span> <span class="string">["tags",</span> <span class="string">"title"</span><span class="string">,</span> <span class="string">"content"</span><span class="string">]</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;,</span></span><br><span class="line"><span class="attr">  "from":</span> <span class="number">0</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "size":</span> <span class="number">10</span><span class="string">,</span></span><br><span class="line"><span class="attr">  "highlight":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">    "pre_tags":</span> <span class="string">["&lt;span</span> <span class="string">class='keyWord'&gt;"],</span></span><br><span class="line"><span class="attr">    "post_tags":</span> <span class="string">["&lt;/span&gt;"],</span></span><br><span class="line"><span class="attr">    "fields":</span> <span class="string">&#123;</span></span><br><span class="line"><span class="attr">      "title":</span> <span class="string">&#123;&#125;,</span></span><br><span class="line"><span class="attr">      "content":</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="scrapy-写入数据到-elasticsearch-中"><a href="#scrapy-写入数据到-elasticsearch-中" class="headerlink" title="scrapy 写入数据到 elasticsearch 中"></a>scrapy 写入数据到 elasticsearch 中</h1><p>编写 pipelines.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> models.es_types <span class="keyword">import</span> ArticleType</span><br><span class="line"><span class="keyword">from</span> w3lib.html <span class="keyword">import</span> remove_tags</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElasticsearchPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""将数据写入到 es 中"""</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self, item, spider)</span>:</span></span><br><span class="line">        <span class="comment"># 将 item 转化为 es 的数据</span></span><br><span class="line">        item.save_to_es()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>
<h2 id="elasticsearch-dsl"><a href="#elasticsearch-dsl" class="headerlink" title="elasticsearch-dsl"></a>elasticsearch-dsl</h2><p><a href="https://github.com/elastic/elasticsearch-dsl-py" target="_blank" rel="noopener">elastic/elasticsearch-dsl-py: High level Python client for Elasticsearch</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install elasticsearch-dsl</span><br></pre></td></tr></table></figure>
<p><a href="https://elasticsearch-dsl.readthedocs.io/en/latest/persistence.html" target="_blank" rel="noopener">Persistence — Elasticsearch DSL 6.3.1 documentation</a></p>
<h3 id="生成-mapping"><a href="#生成-mapping" class="headerlink" title="生成 mapping"></a>生成 mapping</h3><p>新建 models 包，models 包和 pipelines.py 在同一级目录。</p>
<p>新建 models/es_types.py 文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> elasticsearch_dsl <span class="keyword">import</span> DocType, Data, Nested, Boolean, analyzer, InnerObjectWrapper, Completion Keyword, Text</span><br><span class="line"><span class="keyword">from</span> elasticsearch_dsl.analysis <span class="keyword">import</span> CustomAnalysis <span class="keyword">as</span> _CustomAnalysis</span><br><span class="line"><span class="keyword">from</span> elasticsearch_dsl.connections <span class="keyword">import</span> connections</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">connections.create_connection(host=[<span class="string">"localhost"</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomAnalyzer</span><span class="params">(_CustomAnalysis)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_analysis_definition</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">ik_analyzer = CustomAnalyzer(<span class="string">"ik_max_word"</span>, filter=[<span class="string">"lowercase"</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleType</span><span class="params">(DocType)</span>:</span></span><br><span class="line">    <span class="comment"># 伯乐在线文章类型</span></span><br><span class="line">    suggest = Completion(analyzer=ik_analyzer)</span><br><span class="line">    title = Text(analyzer=<span class="string">"ik_max_word"</span>)</span><br><span class="line">    create_date = Date()</span><br><span class="line">    url = Keyword()</span><br><span class="line">    url_object_id = Keyword()</span><br><span class="line">    front_image_url = Keyword()</span><br><span class="line">    front_image_path = Keyword()</span><br><span class="line">    praise_nums = Integer()</span><br><span class="line">    comment_nums = Integer()</span><br><span class="line">    fav_nums = Integer()</span><br><span class="line">    tags = Text(analyzer=<span class="string">"ik_max_word"</span>)</span><br><span class="line">    content = Text(analyzer=<span class="string">"ik_max_word"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        index = <span class="string">"jobbole"</span></span><br><span class="line">        doc_type = <span class="string">"article"</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 生成 mapping</span></span><br><span class="line">    ArticleType.init()</span><br></pre></td></tr></table></figure>
<p>items.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> models.es_types <span class="keyword">import</span> ArticleType</span><br><span class="line"><span class="keyword">from</span> elasticsearch_dsl.connections <span class="keyword">import</span> connections</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">es = connections.create_connection(ArticleType._doc_type.using)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_suggest</span><span class="params">(index, info_tuple)</span>:</span></span><br><span class="line">    <span class="comment"># 根据字符串生成搜索建议数组</span></span><br><span class="line">    used_words = set()  <span class="comment"># 去重</span></span><br><span class="line">    suggests = []</span><br><span class="line">    <span class="keyword">for</span> text, weight <span class="keyword">in</span> info_tuple:</span><br><span class="line">        <span class="keyword">if</span> text:</span><br><span class="line">            <span class="comment"># 调用 es 的 analyze 接口分析字符串，进行分词。</span></span><br><span class="line">            words = es.indices.analyze(index=index, analyzer=<span class="string">"ik_max_word"</span>, params=&#123;<span class="string">'filter'</span>:[<span class="string">"lowercase"</span>]&#125;, body=text)</span><br><span class="line">            analyzed_words = set([r[<span class="string">"token"</span>] <span class="keyword">for</span> r <span class="keyword">in</span> words <span class="keyword">if</span> len(r[<span class="string">"token"</span>])&gt;<span class="number">1</span>])</span><br><span class="line">            new_words = analyzed_words - used_words</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new_words = set()</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> new_words:</span><br><span class="line">            suggests.append(&#123;<span class="string">"input"</span>:list(new_words), <span class="string">"weight"</span>:weight&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> suggests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobBoleArticleItem</span><span class="params">(scrapy.Item)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save_to_es</span><span class="params">(self)</span>:</span></span><br><span class="line">        article = ArticleType()</span><br><span class="line">        article.title = self[<span class="string">'title'</span>]</span><br><span class="line">        article.create_date = self[<span class="string">'create_date'</span>]</span><br><span class="line">        article.content = remove_tags(self[<span class="string">'content'</span>])</span><br><span class="line">        article.front_image_url = self[<span class="string">'front_image_url'</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"front_image_path"</span> <span class="keyword">in</span> self:</span><br><span class="line">            article.front_image_path = self[<span class="string">'front_image_path'</span>]</span><br><span class="line">        article.praise_nums = self[<span class="string">'praise_nums'</span>]</span><br><span class="line">        article.fav_nums = self[<span class="string">'fav_nums'</span>]</span><br><span class="line">        article.comments_nums = self[<span class="string">'comments_nums'</span>]</span><br><span class="line">        article.url = self[<span class="string">'url'</span>]</span><br><span class="line">        article.tags = self[<span class="string">'tags'</span>]</span><br><span class="line">        article.meta.id = self[<span class="string">'url_object_id'</span>]</span><br><span class="line">        </span><br><span class="line">        article.suggest = gen_suggests(ArticleType._doc_type.index, ((article.title, <span class="number">10</span>),(article.tags, <span class="number">7</span>)))</span><br><span class="line">        </span><br><span class="line">        article.save()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>
<h2 id="第11章-Django搭建搜索网站-1"><a href="#第11章-Django搭建搜索网站-1" class="headerlink" title="第11章 Django搭建搜索网站"></a>第11章 Django搭建搜索网站</h2><p>本章讲解如何通过django快速搭建搜索网站， 本章也会讲解如何完成django与elasticsearch的搜索查询交互。</p>
<h1 id="通过-django-和-elasticsearch-搭建搜索网站"><a href="#通过-django-和-elasticsearch-搭建搜索网站" class="headerlink" title="通过 django 和 elasticsearch 搭建搜索网站"></a>通过 django 和 elasticsearch 搭建搜索网站</h1><p>开始写代码前，要了解系统的功能。</p>
<h1 id="django"><a href="#django" class="headerlink" title="django"></a>django</h1><h2 id="新建虚拟环境"><a href="#新建虚拟环境" class="headerlink" title="新建虚拟环境"></a>新建虚拟环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkvirtualenv --python=3.5.0 lcv_search</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里我要提醒大家的是，大家最好跟我课程里的 Python 版本保持一致，不然后边的话有可能会出现问题。大家在学习的时候尽跟我的版本保持一致，大家在开发完成之后，自己再去尝试自己的新版本。</p>
</blockquote>
<blockquote>
<p>我使用的是 Python 3.6.1</p>
</blockquote>
<p><strong>安装 django</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django==1.11</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipenv install --pypi-mirror=https://pypi.douban.com/simple django==1.11</span><br></pre></td></tr></table></figure>
<p><strong>安装 elasticsearch-dsl</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install elasticsearch-dsl==5.2.0</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipenv install --pypi-mirror=https://pypi.douban.com/simple elasticsearch-dsl==5.2.0</span><br></pre></td></tr></table></figure>
<p><strong>安装 redis</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install redis==2.10.5</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipenv install --pypi-mirror=https://pypi.douban.com/simple redis==2.10.5</span><br></pre></td></tr></table></figure>
<h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2><p>PyCharm 中 新建项目 django 项目 <code>LcvSearch</code></p>
<ul>
<li>Appcation Name：<code>search</code></li>
<li>Enable Django admin</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建项目</span></span><br><span class="line">django-admin startproject LcvSearch</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建 App</span></span><br><span class="line">python manage.py startapp search</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行</span></span><br><span class="line">python manage.py runserver 127.0.0.1:8000</span><br></pre></td></tr></table></figure>
<p><strong>添加 app</strong> 到 settings.py</p>
<p>LcvSearch/settings.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'search'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>配置静态页面</strong></p>
<p>新建目录 static。（和manage.py 同一目录，此目录可以随意命名，可配置。）（放置 css, js 文件）</p>
<p>新建目录 templates。（index.html, result.html 放在这个目录）（放置 html 模板文件）</p>
<p><strong>配置 url</strong></p>
<p>LcvSearch/LcvSearch/urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.generic <span class="keyword">import</span> TemplateView</span><br><span class="line"></span><br><span class="line">url(<span class="string">r'^$'</span>, TemplateView.as_view(template_name=<span class="string">"index.html"</span>), name=<span class="string">"index"</span>),</span><br></pre></td></tr></table></figure>
<p><strong>配置  templates 路径</strong></p>
<p>settings.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.django.DjangoTemplates'</span>,</span><br><span class="line">        <span class="string">'DIRS'</span>: [os.path.join(BASE_DIR, <span class="string">"templates"</span>)],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>配置 static 路径</strong> </p>
<p>settings.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">"static"</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以用 tuple，后面要加逗号。</span></span><br><span class="line">STATICFILES_DIRS = ()</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">"static"</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>修改 html 文件，添加路径。</strong></p>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load staticfiles %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% static 'css/style.css' %&#125;</span><br><span class="line">&#123;% static 'js/global.js' %&#125;</span><br></pre></td></tr></table></figure>
<h2 id="suggest-搜索建议（自动补全）"><a href="#suggest-搜索建议（自动补全）" class="headerlink" title="suggest 搜索建议（自动补全）"></a>suggest 搜索建议（自动补全）</h2><p><strong>配置 url</strong></p>
<p>LcvSearch/urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> search.views <span class="keyword">import</span> SearchSuggest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url(<span class="string">r'^suggest/$'</span>, SearchSuggest.as_view(), name=<span class="string">"suggest"</span>),</span><br></pre></td></tr></table></figure>
<p><strong>Model 逻辑</strong></p>
<p>search/models.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> elasticsearch_dsl <span class="keyword">import</span> DocType, Data, Nested, Boolean, analyzer, InnerObjectWrapper, Completion Keyword, Text</span><br><span class="line"><span class="keyword">from</span> elasticsearch_dsl.analysis <span class="keyword">import</span> CustomAnalysis <span class="keyword">as</span> _CustomAnalysis</span><br><span class="line"><span class="keyword">from</span> elasticsearch_dsl.connections <span class="keyword">import</span> connections</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">connections.create_connection(host=[<span class="string">"localhost"</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomAnalyzer</span><span class="params">(_CustomAnalysis)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_analysis_definition</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">ik_analyzer = CustomAnalyzer(<span class="string">"ik_max_word"</span>, filter=[<span class="string">"lowercase"</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleType</span><span class="params">(DocType)</span>:</span></span><br><span class="line">    <span class="comment"># 伯乐在线文章类型</span></span><br><span class="line">    suggest = Completion(analyzer=ik_analyzer)</span><br><span class="line">    title = Text(analyzer=<span class="string">"ik_max_word"</span>)</span><br><span class="line">    create_date = Date()</span><br><span class="line">    url = Keyword()</span><br><span class="line">    url_object_id = Keyword()</span><br><span class="line">    front_image_url = Keyword()</span><br><span class="line">    front_image_path = Keyword()</span><br><span class="line">    praise_nums = Integer()</span><br><span class="line">    comment_nums = Integer()</span><br><span class="line">    fav_nums = Integer()</span><br><span class="line">    tags = Text(analyzer=<span class="string">"ik_max_word"</span>)</span><br><span class="line">    content = Text(analyzer=<span class="string">"ik_max_word"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        index = <span class="string">"jobbole"</span></span><br><span class="line">        doc_type = <span class="string">"article"</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 生成 mapping</span></span><br><span class="line">    ArticleType.init()</span><br></pre></td></tr></table></figure>
<p><strong>View 逻辑</strong></p>
<p>search/views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.views.generic.base <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> search.models <span class="keyword">import</span> ArticleType</span><br><span class="line"><span class="comment"># def suggest(request):</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchSuggest</span><span class="params">(View)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        key_words = request.GET.get(<span class="string">'s'</span>, <span class="string">''</span>)</span><br><span class="line">        re_datas = []</span><br><span class="line">        <span class="keyword">if</span> key_words:</span><br><span class="line">            s = ArticleType.search()</span><br><span class="line">            s = s.suggest(<span class="string">'my_suggest'</span>, key_words, completion=&#123;</span><br><span class="line">                <span class="string">"field"</span>: <span class="string">"suggest"</span>,</span><br><span class="line">        		<span class="string">"fuzzy"</span>: &#123;</span><br><span class="line">          			<span class="string">"fuzziness"</span>: <span class="number">2</span></span><br><span class="line">        		&#125;,</span><br><span class="line">                <span class="string">"size"</span>: <span class="number">10</span></span><br><span class="line">            &#125;)</span><br><span class="line">            suggestions = s.execute_suggest()</span><br><span class="line">            <span class="comment"># for match in getattr(suggestions, "my_suggest")[0].options:</span></span><br><span class="line">            <span class="keyword">for</span> match <span class="keyword">in</span> suggestions.my_suggest[<span class="number">0</span>].options:</span><br><span class="line">                source = match._source</span><br><span class="line">                re_datas.append(source[<span class="string">"title"</span>])</span><br><span class="line">         <span class="keyword">return</span> HttpResponse(json.dumps(re_datas), content_type=<span class="string">"application/json"</span>)</span><br></pre></td></tr></table></figure>
<p>调试代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">s = ArticleType.search()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此处打断点 s = s.suggest('my-suggest', keywords, completion=&#123;</span></span><br><span class="line">s = s.suggest(<span class="string">'my-suggest'</span>, keywords, completion=&#123;</span><br><span class="line">    <span class="string">"field"</span>: <span class="string">"suggest"</span>,</span><br><span class="line">    <span class="string">"fuzzy"</span>: &#123;</span><br><span class="line">        <span class="string">"fuzziness"</span>: <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"size"</span>: <span class="number">10</span></span><br><span class="line">&#125;)</span><br><span class="line">suggestions = s.execute_suggest()</span><br><span class="line"><span class="keyword">for</span> match <span class="keyword">in</span> suggestions:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><strong>html 配置</strong></p>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var suggest_url = "&#123;% url "suggest" %&#125;"</span><br></pre></td></tr></table></figure>
<h2 id="搜索功能"><a href="#搜索功能" class="headerlink" title="搜索功能"></a>搜索功能</h2><p><strong>配置 url</strong></p>
<p>LcvSearch/urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^search/$'</span>, SearchView.as_view(), name=<span class="string">"search"</span>),</span><br></pre></td></tr></table></figure>
<p><strong>配置 View</strong></p>
<p>search/views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span> Elasticsearch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">client = Elasticsearch(hosts=[<span class="string">"127.0.0.1"</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchView</span><span class="params">(View)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        key_words = request.GET.get(<span class="string">"q"</span>, <span class="string">""</span>)</span><br><span class="line">        page = request.GET.get(<span class="string">"p"</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            page = int(page)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            page = <span class="number">1</span></span><br><span class="line">        start_time = datetime.now()</span><br><span class="line">        response = client.search(</span><br><span class="line">            index=<span class="string">"jobbole"</span>,</span><br><span class="line">            body=&#123;</span><br><span class="line">                <span class="string">"query"</span>:&#123;</span><br><span class="line">                    <span class="string">"multi_match"</span>:&#123;</span><br><span class="line">                        <span class="string">"query"</span>: key_words,</span><br><span class="line">                        <span class="string">"fields"</span>: [<span class="string">"tags"</span>, <span class="string">"title"</span>, <span class="string">"content"</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"form"</span>:<span class="number">0</span>,</span><br><span class="line">                <span class="string">"size"</span>:<span class="number">10</span>,</span><br><span class="line">                <span class="string">"highlight"</span>: &#123;</span><br><span class="line">                    <span class="string">"pre_tags"</span>: [<span class="string">'&lt;span class="keyWord"&gt;'</span>],</span><br><span class="line">                    <span class="string">"post_tags"</span>: [<span class="string">'&lt;/span&gt;'</span>],</span><br><span class="line">                    <span class="string">"fields"</span>: &#123;</span><br><span class="line">                        <span class="string">"title"</span>: &#123;&#125;,</span><br><span class="line">                        <span class="string">"content"</span>: &#123;&#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        end_time = datetime.now()</span><br><span class="line">        last_seconds = (end_time-start_time).total_seconds()</span><br><span class="line">        total_nums = response[<span class="string">"hits"</span>][<span class="string">"total"</span>]</span><br><span class="line">        <span class="keyword">if</span> (page%<span class="number">10</span>) &gt; <span class="number">0</span>:</span><br><span class="line">            page_nums = int(total_nums/<span class="number">10</span>) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            page_nums = int(total_nums/<span class="number">10</span>)</span><br><span class="line">        hit_list = []</span><br><span class="line">        <span class="keyword">for</span> hit <span class="keyword">in</span> response[<span class="string">"hits"</span>][<span class="string">"hits"</span>]:</span><br><span class="line">            hit_dict = &#123;&#125;</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"title"</span> <span class="keyword">in</span> hit[<span class="string">"highlight"</span>]:</span><br><span class="line">                hit_dict[<span class="string">"title"</span>] = <span class="string">""</span>.join(hit[<span class="string">"highligh"</span>][<span class="string">"title"</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                hit_dict[<span class="string">"title"</span>] = hit[<span class="string">"_source"</span>][<span class="string">"title"</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"content"</span> <span class="keyword">in</span> hit[<span class="string">"highlight"</span>]:</span><br><span class="line">                hit_dict[<span class="string">"content"</span>] = <span class="string">""</span>.join(hit[<span class="string">"highligh"</span>][<span class="string">"content"</span>])[:<span class="number">500</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                hit_dict[<span class="string">"content"</span>] = hit[<span class="string">"_source"</span>][<span class="string">"content"</span>][:<span class="number">500</span>]</span><br><span class="line">                </span><br><span class="line">            hit_dict[<span class="string">"create_date"</span>] = hit[<span class="string">"_source"</span>][<span class="string">"create_date"</span>]</span><br><span class="line">            hit_dict[<span class="string">"url"</span>] = hit[<span class="string">"_source"</span>][<span class="string">"url"</span>]</span><br><span class="line">            hit_dict[<span class="string">"score"</span>] = hit[<span class="string">"_score"</span>]</span><br><span class="line">            </span><br><span class="line">            hit_list.append(hit_dict)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"result.html"</span>, &#123;<span class="string">"page"</span>:page, <span class="string">"all_hits"</span>: hit_list, <span class="string">"key_words"</span>: key_words, <span class="string">"total_nums"</span>: total_nums, <span class="string">"page_nums"</span>: page_nums, <span class="string">"last_seconds"</span>: last_seconds&#125;)</span><br></pre></td></tr></table></figure>
<p>调试代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">response = client.search(</span><br><span class="line">    index=<span class="string">"jobbole"</span>,</span><br><span class="line">    body=&#123;</span><br><span class="line">        <span class="string">"query"</span>:&#123;</span><br><span class="line">            <span class="string">"multi_match"</span>:&#123;</span><br><span class="line">                <span class="string">"query"</span>: keywords,</span><br><span class="line">                <span class="string">"fields"</span>: [<span class="string">"tags"</span>, <span class="string">"title"</span>, <span class="string">"content"</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"form"</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="string">"size"</span>:<span class="number">10</span>,</span><br><span class="line">        <span class="string">"highlight"</span>: &#123;</span><br><span class="line">            <span class="string">"pre_tags"</span>: [<span class="string">'&lt;span class="keyWord"&gt;'</span>],</span><br><span class="line">            <span class="string">"post_tags"</span>: [<span class="string">'&lt;/span&gt;'</span>],</span><br><span class="line">            <span class="string">"fields"</span>: &#123;</span><br><span class="line">                <span class="string">"title"</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">"content"</span>: &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此处打断点 total_nums = response["hits"]["total"]</span></span><br><span class="line">total_nums = response[<span class="string">"hits"</span>][<span class="string">"total"</span>]</span><br></pre></td></tr></table></figure>
<p><strong>配置 html</strong></p>
<p>result.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load staticfiles %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% static 'css/style.css' %&#125;</span><br><span class="line">&#123;% static 'js/global.js' %&#125;</span><br><span class="line"></span><br><span class="line">var search_url = "&#123;% url 'search' %&#125;"</span><br></pre></td></tr></table></figure>
<p>删除所有 <code>div class=&quot;resultItem&quot;</code>，只保留一个即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"resultList"</span>&gt;</span></span><br><span class="line">    &#123;% for hit in all_hits %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"resultItem"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"itemHead"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;&#123; hit.url &#125;&#125;"</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>&#123;% autoescape off %&#125;&#123;&#123; hit.title &#125;&#125;&#123;% endautoescape %&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"dependValue"</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"value"</span>&gt;</span>&#123;&#123; hit.score &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"itemBody"</span>&gt;</span></span><br><span class="line">            &#123;% autoescape off %&#125;&#123;&#123; hit.content&#125;&#125;&#123;% endautoescape %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var search_url = "&#123;% url 'search' %&#125;"</span><br></pre></td></tr></table></figure>
<h1 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h1><p>result.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//分页</span><br><span class="line">$(".pagination").pagination(&#123;&#123; total_nums &#125;&#125;), &#123;</span><br><span class="line">	current_page:&#123;&#123; page|add:'-1'&#125;&#125;,</span><br><span class="line">	items_per_page: 10,</span><br><span class="line">	display_msg:true,</span><br><span class="line">	callback:pageselectCallback	</span><br><span class="line">&#125;);</span><br><span class="line">function pageselectCallback(page_id, jq)&#123;</span><br><span class="line">	window.location.href=search_url+'?q'+key_words+'&amp;p='+page_id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"totalResult"</span>&gt;</span>&#123;&#123; total_nums &#125;&#125; </span><br><span class="line">    class="time"&gt;&#123;&#123; last_seconds &#125;&#125;</span><br><span class="line">    class="totalPage"&gt;&#123;&#123; page_nums &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"resultTotal"</span>&gt;</span></span><br><span class="line">                	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"info"</span>&gt;</span>找到约&amp;nbsp;<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"totalResult"</span>&gt;</span>&#123;&#123; total_nums &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&amp;nbsp;条结果(用时<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"time"</span>&gt;</span>&#123;&#123; last_seconds &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>秒)，共约<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"totalPage"</span>&gt;</span>&#123;&#123; page_nums &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>页<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>search/views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">page = request.GET.get(<span class="string">"p"</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    page = int(page)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    page = <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">"page"</span>:page, <span class="string">"total_nums"</span>: total_nums</span><br></pre></td></tr></table></figure>
<h1 id="开发知识点"><a href="#开发知识点" class="headerlink" title="开发知识点"></a>开发知识点</h1><p>本地缓存，前端 js</p>
<p>add_search 事件</p>
<p>killRepeat </p>
<h2 id="网站-填充的内容"><a href="#网站-填充的内容" class="headerlink" title="网站 填充的内容"></a>网站 填充的内容</h2><p>通过 redis 存储统计数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redis_cli = redis.StrictRedis(host=<span class="string">"localhost"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_to_es</span><span class="params">(self)</span>:</span></span><br><span class="line">    redis_cli.incr(<span class="string">"jobbole_count"</span>)</span><br></pre></td></tr></table></figure>
<p>调试代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redis_cli = redis.StrictRedis(host=<span class="string">"localhost"</span>)</span><br><span class="line">redis_cli.incr(<span class="string">"jobbole_count"</span>)</span><br></pre></td></tr></table></figure>
<p>redis-cli</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keys *</span><br><span class="line"></span><br><span class="line">type jobbole_count</span><br><span class="line"></span><br><span class="line">get jobbole_count</span><br></pre></td></tr></table></figure>
<p>views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">redis_cli = redis.StrictRedis()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jobbole_count = redis_cli.get(<span class="string">"jobbole_count"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"jobbole_count"</span>: jobbole_count</span><br></pre></td></tr></table></figure>
<p>result.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">网站</span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"unit"</span>&gt;</span>&#123;&#123; jobbole_count &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"subfield"</span>&gt;</span>网站<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"subfieldContext"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"name"</span>&gt;</span>伯乐在线<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"unit"</span>&gt;</span>(&#123;&#123; jobbole_count &#125;&#125;)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="热门搜索"><a href="#热门搜索" class="headerlink" title="热门搜索"></a>热门搜索</h2><p>redis 排序</p>
<p>ZINCRBY 为有序集 key 做增量加1。</p>
<p>ZREVERANGEBYSCORE</p>
<p><strong>配置 result.html</strong></p>
<p>views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis_cli.zincrby(<span class="string">"search_keywords_set"</span>, key_words)</span><br><span class="line"></span><br><span class="line">topn_search = redis_cli.zrevrangebyscore(<span class="string">"search_keywords_set"</span>, <span class="string">"+inf"</span>, <span class="string">"-inf"</span>, start=<span class="number">0</span>, num=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="string">"topn_search"</span>: topn_search</span><br></pre></td></tr></table></figure>
<p>result.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ul class="historyList"</span><br><span class="line">&#123;% for search_word in topn_search %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/search?q=&#123;&#123; search_word &#125;&#125;"</span>&gt;</span>&#123;&#123; search_word &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hotSearch"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h6</span>&gt;</span>热门搜索<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"historyList"</span>&gt;</span></span><br><span class="line">        &#123;% for search_word in topn_search %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/search?q=&#123;&#123; search_word &#125;&#125;"</span>&gt;</span>&#123;&#123; search_word &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置 index.html</strong> </p>
<p>search/views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span><span class="params">(View)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 首页</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        topn_search = redis_cli.zrevrangebyscore(<span class="string">"search_keywords_set"</span>, <span class="string">"+inf"</span>, <span class="string">"-inf"</span>, start=<span class="number">0</span>, num=<span class="number">5</span>)</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">"index.html"</span>, &#123;<span class="string">"topn_search"</span>: topn_search&#125;)</span><br></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class="history</span><br><span class="line">&#123;% for search_words in topn_search %&#125;</span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/search?q=&#123;&#123; search_words &#125;&#125;"</span>&gt;</span>&#123;&#123; search_words &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"historyArea"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"history"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>热门搜索：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"history mysearch"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>我的搜索：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        &#123;% for search_word in topn_search %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"all-search"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/search?q=&#123;&#123; search_word &#125;&#125;"</span>&gt;</span>&#123;&#123; search_word &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<p>LcvSearch/urls.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^$'</span>, IndexView.as_view(), name=<span class="string">"index"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="搜索类型"><a href="#搜索类型" class="headerlink" title="搜索类型"></a>搜索类型</h2><p>views.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SearchView():</span><br><span class="line">	s_type = request.GET.get(<span class="string">"s_type"</span>, <span class="string">"article"</span>)</span><br></pre></td></tr></table></figure>
<p>github django-dynamic-scrapper</p>
<h2 id="第12章-Scrapyd部署Scrapy爬虫-1"><a href="#第12章-Scrapyd部署Scrapy爬虫-1" class="headerlink" title="第12章 Scrapyd部署Scrapy爬虫"></a>第12章 Scrapyd部署Scrapy爬虫</h2><p>本章主要通过scrapyd完成对scrapy爬虫的线上部署。</p>
<h2 id="第13章-课程总结-1"><a href="#第13章-课程总结-1" class="headerlink" title="第13章 课程总结"></a>第13章 课程总结</h2><p>重新梳理一遍系统开发的整个过程， 让同学对系统和开发过程有一个更加直观的理解</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Python+Web开发实战-学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/01/Python+Web开发实战-学习笔记/" class="article-date">
      <time datetime="2017-05-01T12:18:02.000Z" itemprop="datePublished">2017-05-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/01/Python+Web开发实战-学习笔记/">Python+Web开发实战 学习笔记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Python+Web开发实战 学习笔记 董伟明</p>
<p>页码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">486 第15章 Web 开发项目实践</span><br></pre></td></tr></table></figure>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-生活总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/01/生活总结/" class="article-date">
      <time datetime="2017-05-01T01:59:11.000Z" itemprop="datePublished">2017-05-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/01/生活总结/">生活总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-工作总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/01/工作总结/" class="article-date">
      <time datetime="2017-05-01T01:58:58.000Z" itemprop="datePublished">2017-05-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/01/工作总结/">工作总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2016-12-12-2017-05-01" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/01/2016-12-12-2017-05-01/" class="article-date">
      <time datetime="2017-05-01T01:58:20.000Z" itemprop="datePublished">2017-05-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/01/2016-12-12-2017-05-01/">2016.12.12-2017.05.01</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/31/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/30/">30</a><a class="page-number" href="/page/31/">31</a><span class="page-number current">32</span><a class="page-number" href="/page/33/">33</a><a class="page-number" href="/page/34/">34</a><span class="space">&hellip;</span><a class="page-number" href="/page/46/">46</a><a class="extend next" rel="next" href="/page/33/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2020 幻舞梦境
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >海贼到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-39498261-3', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?1bb44bf25fea8f000a1397f9b5438de7";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>